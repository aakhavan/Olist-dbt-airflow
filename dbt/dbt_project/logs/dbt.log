[0m20:34:56.495805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b275bce30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b275a3e00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b2718bb90>]}


============================== 20:34:56.501056 | 99ceaaf8-12a3-472f-a5fe-a29222eb314a ==============================
[0m20:34:56.501056 [info ] [MainThread]: Running with dbt=1.8.9
[0m20:34:56.502657 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/usr/app/dbt/dbt_project/logs', 'debug': 'False', 'profiles_dir': '.', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir .', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:34:56.780383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '99ceaaf8-12a3-472f-a5fe-a29222eb314a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b26ef70b0>]}
[0m20:34:56.871778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '99ceaaf8-12a3-472f-a5fe-a29222eb314a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b274d9be0>]}
[0m20:34:56.874174 [info ] [MainThread]: Registered adapter: clickhouse=1.8.0
[0m20:34:57.094852 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m20:34:57.098950 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m20:34:57.099797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '99ceaaf8-12a3-472f-a5fe-a29222eb314a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b2807afc0>]}
[0m20:35:01.549789 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '99ceaaf8-12a3-472f-a5fe-a29222eb314a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b26b6fc80>]}
[0m20:35:01.980612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '99ceaaf8-12a3-472f-a5fe-a29222eb314a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b26b99bb0>]}
[0m20:35:01.981958 [info ] [MainThread]: Found 8 models, 5 sources, 464 macros
[0m20:35:01.983253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '99ceaaf8-12a3-472f-a5fe-a29222eb314a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b27d16030>]}
[0m20:35:01.989224 [info ] [MainThread]: 
[0m20:35:01.991472 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m20:35:02.014459 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m20:35:02.021045 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m20:35:02.090514 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:35:02.091903 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:35:02.307108 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m20:35:02.308822 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m20:35:02.313879 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:35:02.315776 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:35:02.348163 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__reporting)
[0m20:35:02.349626 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__intermediate)
[0m20:35:02.378119 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__reporting: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list__reporting"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'reporting'
      

  ...
[0m20:35:02.383054 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__intermediate: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list__intermediate"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'intermediate'
      

  ...
[0m20:35:02.397840 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:02.399790 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:02.415860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '99ceaaf8-12a3-472f-a5fe-a29222eb314a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b26cb7830>]}
[0m20:35:02.417318 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:35:02.418892 [info ] [MainThread]: 
[0m20:35:02.472403 [debug] [Thread-1 (]: Began running node model.olist_dbt.stg_customers
[0m20:35:02.473425 [debug] [Thread-2 (]: Began running node model.olist_dbt.stg_order_items
[0m20:35:02.474408 [debug] [Thread-3 (]: Began running node model.olist_dbt.stg_order_payments
[0m20:35:02.475585 [debug] [Thread-4 (]: Began running node model.olist_dbt.stg_order_reviews
[0m20:35:02.476965 [info ] [Thread-1 (]: 1 of 8 START sql view model `intermediate`.`stg_customers` ..................... [RUN]
[0m20:35:02.480601 [info ] [Thread-2 (]: 2 of 8 START sql view model `intermediate`.`stg_order_items` ................... [RUN]
[0m20:35:02.482817 [info ] [Thread-3 (]: 3 of 8 START sql view model `intermediate`.`stg_order_payments` ................ [RUN]
[0m20:35:02.485364 [info ] [Thread-4 (]: 4 of 8 START sql view model `intermediate`.`stg_order_reviews` ................. [RUN]
[0m20:35:02.492689 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__intermediate, now model.olist_dbt.stg_customers)
[0m20:35:02.494485 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list__reporting, now model.olist_dbt.stg_order_items)
[0m20:35:02.496450 [debug] [Thread-3 (]: Acquiring new clickhouse connection 'model.olist_dbt.stg_order_payments'
[0m20:35:02.498121 [debug] [Thread-4 (]: Acquiring new clickhouse connection 'model.olist_dbt.stg_order_reviews'
[0m20:35:02.499571 [debug] [Thread-1 (]: Began compiling node model.olist_dbt.stg_customers
[0m20:35:02.500907 [debug] [Thread-2 (]: Began compiling node model.olist_dbt.stg_order_items
[0m20:35:02.502257 [debug] [Thread-3 (]: Began compiling node model.olist_dbt.stg_order_payments
[0m20:35:02.503559 [debug] [Thread-4 (]: Began compiling node model.olist_dbt.stg_order_reviews
[0m20:35:02.533920 [debug] [Thread-2 (]: Writing injected SQL for node "model.olist_dbt.stg_order_items"
[0m20:35:02.531399 [debug] [Thread-1 (]: Writing injected SQL for node "model.olist_dbt.stg_customers"
[0m20:35:02.543756 [debug] [Thread-3 (]: Writing injected SQL for node "model.olist_dbt.stg_order_payments"
[0m20:35:02.552584 [debug] [Thread-4 (]: Writing injected SQL for node "model.olist_dbt.stg_order_reviews"
[0m20:35:02.600212 [debug] [Thread-4 (]: Began executing node model.olist_dbt.stg_order_reviews
[0m20:35:02.666522 [debug] [Thread-3 (]: Began executing node model.olist_dbt.stg_order_payments
[0m20:35:02.667660 [debug] [Thread-1 (]: Began executing node model.olist_dbt.stg_customers
[0m20:35:02.676382 [debug] [Thread-2 (]: Began executing node model.olist_dbt.stg_order_items
[0m20:35:02.838682 [debug] [Thread-2 (]: Writing runtime sql for node "model.olist_dbt.stg_order_items"
[0m20:35:02.840275 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m20:35:02.851229 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:35:02.856980 [debug] [Thread-1 (]: Writing runtime sql for node "model.olist_dbt.stg_customers"
[0m20:35:02.969543 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */


  create view `intermediate`.`stg_customers__dbt_tmp` 
  
    
    
  as (
    select
    customer_id,
    customer_unique_id,
    customer_zip_code_prefix,
    customer_city,
    customer_state
from `raw`.`olist_customers_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m20:35:02.974371 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */


  create view `intermediate`.`stg_order_items__dbt_tmp` 
  
    
    
  as (
    select
    order_id,
    order_item_id,
    product_id,
    seller_id,
    parseDateTimeBestEffortOrNull(shipping_limit_date) as shipping_limit_date,
    toFloat64OrNull(price) as price,
    toFloat64OrNull(freight_value) as freight_value,
    
    round(cast(toFloat64(price) as decimal(16, 2)), 2)
 as price_dollars
from `raw`.`olist_order_items_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m20:35:02.989148 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m20:35:03.018039 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m20:35:03.019606 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    drop table if exists `intermediate`.`stg_customers__dbt_backup` 
  
  ...
[0m20:35:03.036832 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    drop table if exists `intermediate`.`stg_order_items__dbt_backup` 
  
  ...
[0m20:35:03.042240 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:03.046993 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    rename table `intermediate`.`stg_customers` to `intermediate`.`stg_customers__dbt_backup` 
  
  ...
[0m20:35:03.052312 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:03.057724 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:03.060921 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    rename table `intermediate`.`stg_order_items` to `intermediate`.`stg_order_items__dbt_backup` 
  
  ...
[0m20:35:03.063957 [debug] [Thread-4 (]: Writing runtime sql for node "model.olist_dbt.stg_order_reviews"
[0m20:35:03.066188 [debug] [Thread-3 (]: Writing runtime sql for node "model.olist_dbt.stg_order_payments"
[0m20:35:03.075549 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    drop table if exists `intermediate`.`stg_customers` 
  
  ...
[0m20:35:03.080977 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:35:03.100673 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    drop table if exists `intermediate`.`stg_order_items` 
  
  ...
[0m20:35:03.102236 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m20:35:03.105229 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */


  create view `intermediate`.`stg_order_reviews__dbt_tmp` 
  
    
    
  as (
    select
    review_id,
    order_id,
    toInt64OrNull(review_score) as review_score,
    review_comment_title,
    review_comment_message,
    parseDateTimeBestEffortOrNull(review_creation_date) as review_creation_date,
    parseDateTimeBestEffortOrNull(review_answer_timestamp) as review_answer_timestamp

from `raw`.`olist_order_reviews_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m20:35:03.109557 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    rename table `intermediate`.`stg_customers__dbt_tmp` to `intermediate`.`stg_customers` 
  
  ...
[0m20:35:03.111225 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */


  create view `intermediate`.`stg_order_payments__dbt_tmp` 
  
    
    
  as (
    select
    order_id,
    payment_sequential,
    payment_type,
    
    round(cast(toFloat64(payment_value) as decimal(16, 2)), 2)
 as payment_value_dollars
from `raw`.`olist_order_payments_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m20:35:03.114902 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:03.121195 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:35:03.124628 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    rename table `intermediate`.`stg_order_items__dbt_tmp` to `intermediate`.`stg_order_items` 
  
  ...
[0m20:35:03.126650 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:03.128936 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:03.157333 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    drop table if exists `intermediate`.`stg_order_reviews__dbt_backup` 
  
  ...
[0m20:35:03.169635 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m20:35:03.173820 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    drop table if exists `intermediate`.`stg_order_payments__dbt_backup` 
  
  ...
[0m20:35:03.232785 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m20:35:03.265691 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    rename table `intermediate`.`stg_order_payments` to `intermediate`.`stg_order_payments__dbt_backup` 
  
  ...
[0m20:35:03.267673 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m20:35:03.300641 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    drop table if exists `intermediate`.`stg_customers__dbt_backup` 
  ...
[0m20:35:03.301809 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    drop table if exists `intermediate`.`stg_order_items__dbt_backup` 
  ...
[0m20:35:03.305099 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    rename table `intermediate`.`stg_order_reviews` to `intermediate`.`stg_order_reviews__dbt_backup` 
  
  ...
[0m20:35:03.307446 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:03.311800 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:35:03.315418 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:03.334700 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99ceaaf8-12a3-472f-a5fe-a29222eb314a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b290302f0>]}
[0m20:35:03.335841 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m20:35:03.326391 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    drop table if exists `intermediate`.`stg_order_payments` 
  
  ...
[0m20:35:03.338941 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99ceaaf8-12a3-472f-a5fe-a29222eb314a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b26d40890>]}
[0m20:35:03.340686 [info ] [Thread-1 (]: 1 of 8 OK created sql view model `intermediate`.`stg_customers` ................ [[32mOK[0m in 0.84s]
[0m20:35:03.351074 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    drop table if exists `intermediate`.`stg_order_reviews` 
  
  ...
[0m20:35:03.355779 [info ] [Thread-2 (]: 2 of 8 OK created sql view model `intermediate`.`stg_order_items` .............. [[32mOK[0m in 0.84s]
[0m20:35:03.358128 [debug] [Thread-1 (]: Finished running node model.olist_dbt.stg_customers
[0m20:35:03.360056 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:03.364936 [debug] [Thread-2 (]: Finished running node model.olist_dbt.stg_order_items
[0m20:35:03.367051 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:03.368600 [debug] [Thread-1 (]: Began running node model.olist_dbt.stg_orders
[0m20:35:03.372437 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    rename table `intermediate`.`stg_order_payments__dbt_tmp` to `intermediate`.`stg_order_payments` 
  
  ...
[0m20:35:03.377463 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    rename table `intermediate`.`stg_order_reviews__dbt_tmp` to `intermediate`.`stg_order_reviews` 
  
  ...
[0m20:35:03.379729 [info ] [Thread-1 (]: 5 of 8 START sql view model `intermediate`.`stg_orders` ........................ [RUN]
[0m20:35:03.385598 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:35:03.387144 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_customers, now model.olist_dbt.stg_orders)
[0m20:35:03.389528 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:03.402190 [debug] [Thread-1 (]: Began compiling node model.olist_dbt.stg_orders
[0m20:35:03.402945 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    drop table if exists `intermediate`.`stg_order_payments__dbt_backup` 
  ...
[0m20:35:03.421198 [debug] [Thread-1 (]: Writing injected SQL for node "model.olist_dbt.stg_orders"
[0m20:35:03.413758 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    drop table if exists `intermediate`.`stg_order_reviews__dbt_backup` 
  ...
[0m20:35:03.426342 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:35:03.431689 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99ceaaf8-12a3-472f-a5fe-a29222eb314a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b248e1a60>]}
[0m20:35:03.433634 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:03.434966 [info ] [Thread-3 (]: 3 of 8 OK created sql view model `intermediate`.`stg_order_payments` ........... [[32mOK[0m in 0.94s]
[0m20:35:03.439702 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99ceaaf8-12a3-472f-a5fe-a29222eb314a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b248a9610>]}
[0m20:35:03.441605 [debug] [Thread-3 (]: Finished running node model.olist_dbt.stg_order_payments
[0m20:35:03.443458 [info ] [Thread-4 (]: 4 of 8 OK created sql view model `intermediate`.`stg_order_reviews` ............ [[32mOK[0m in 0.94s]
[0m20:35:03.446734 [debug] [Thread-4 (]: Finished running node model.olist_dbt.stg_order_reviews
[0m20:35:03.448057 [debug] [Thread-1 (]: Began executing node model.olist_dbt.stg_orders
[0m20:35:03.455606 [debug] [Thread-1 (]: Writing runtime sql for node "model.olist_dbt.stg_orders"
[0m20:35:03.466968 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */


  create view `intermediate`.`stg_orders__dbt_tmp` 
  
    
    
  as (
    select
    order_id,
    customer_id,
    order_status,
    parseDateTimeBestEffortOrNull(order_purchase_timestamp) as order_purchase_timestamp,
    parseDateTimeBestEffortOrNull(order_approved_at) as order_approved_at,
    parseDateTimeBestEffortOrNull(order_delivered_carrier_date) as order_delivered_carrier_date,
    parseDateTimeBestEffortOrNull(order_delivered_customer_date) as order_delivered_customer_date,
    parseDateTimeBestEffortOrNull(order_estimated_delivery_date) as order_estimated_delivery_date
from `raw`.`olist_orders_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m20:35:03.480181 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:03.494347 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    drop table if exists `intermediate`.`stg_orders__dbt_backup` 
  
  ...
[0m20:35:03.499727 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:35:03.503041 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    rename table `intermediate`.`stg_orders` to `intermediate`.`stg_orders__dbt_backup` 
  
  ...
[0m20:35:03.508190 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:35:03.520095 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    drop table if exists `intermediate`.`stg_orders` 
  
  ...
[0m20:35:03.524484 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:35:03.527719 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    rename table `intermediate`.`stg_orders__dbt_tmp` to `intermediate`.`stg_orders` 
  
  ...
[0m20:35:03.532709 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:35:03.539556 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    drop table if exists `intermediate`.`stg_orders__dbt_backup` 
  ...
[0m20:35:03.544009 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:35:03.547545 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99ceaaf8-12a3-472f-a5fe-a29222eb314a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3afdf8fb90>]}
[0m20:35:03.548884 [info ] [Thread-1 (]: 5 of 8 OK created sql view model `intermediate`.`stg_orders` ................... [[32mOK[0m in 0.16s]
[0m20:35:03.550460 [debug] [Thread-1 (]: Finished running node model.olist_dbt.stg_orders
[0m20:35:03.553114 [debug] [Thread-2 (]: Began running node model.olist_dbt.fct_orders
[0m20:35:03.554549 [info ] [Thread-2 (]: 6 of 8 START sql incremental model `reporting`.`fct_orders` .................... [RUN]
[0m20:35:03.555930 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_order_items, now model.olist_dbt.fct_orders)
[0m20:35:03.557261 [debug] [Thread-2 (]: Began compiling node model.olist_dbt.fct_orders
[0m20:35:03.573121 [debug] [Thread-2 (]: Writing injected SQL for node "model.olist_dbt.fct_orders"
[0m20:35:03.592529 [debug] [Thread-2 (]: Began executing node model.olist_dbt.fct_orders
[0m20:35:03.697297 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.fct_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.fct_orders"} */

    select name, type from system.columns where table = 'fct_orders'
    
      and database = 'reporting'
    
    order by position
  ...
[0m20:35:03.705337 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:03.716651 [debug] [Thread-2 (]: Writing runtime sql for node "model.olist_dbt.fct_orders"
[0m20:35:03.737659 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.fct_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.fct_orders"} */

        insert into `reporting`.`fct_orders`
        ("order_id", "customer_id", "order_status", "order_purchase_timestamp", "order_approved_at", "order_delivered_customer_date", "total_amount")-- sql


with order_payments as (
    select
        order_id,
        sum(toFloat64(payment_value_dollars)) as total_amount
    from `intermediate`.`stg_order_payments`
    group by 1
)

select
    o.order_id,
    o.customer_id,
    o.order_status,

    -- Always non-NULL DateTime for adapter's CAST('timestamp')
    ifNull(
      parseDateTimeBestEffortOrNull(nullIf(toString(o.order_purchase_timestamp), '')),
      toDateTime('1970-01-01 00:00:00')
    ) as order_purchase_timestamp,

    ifNull(
      parseDateTimeBestEffortOrNull(nullIf(toString(o.order_approved_at), '')),
      toDateTime('1970-01-01 00:00:00')
    ) as order_approved_at,

    ifNull(
      parseDateTimeBestEffortOrNull(nullIf(toString(o.order_delivered_customer_date), '')),
      toDateTime('1970-01-01 00:00:00')
    ) as order_delivered_customer_date,

    ifNull(op.total_amount, 0.0) as total_amount
from `intermediate`.`stg_orders` o
left join order_payments op on o.order_id = op.order_id


  where order_purchase_timestamp > (select max(order_purchase_timestamp) from `reporting`.`fct_orders`)

    ...
[0m20:35:03.886298 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.15 seconds
[0m20:35:03.898519 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99ceaaf8-12a3-472f-a5fe-a29222eb314a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3afdfac740>]}
[0m20:35:03.900161 [info ] [Thread-2 (]: 6 of 8 OK created sql incremental model `reporting`.`fct_orders` ............... [[32mOK[0m in 0.34s]
[0m20:35:03.902280 [debug] [Thread-2 (]: Finished running node model.olist_dbt.fct_orders
[0m20:35:03.905518 [debug] [Thread-4 (]: Began running node model.olist_dbt.mart_customer_revenue
[0m20:35:03.906855 [debug] [Thread-1 (]: Began running node model.olist_dbt.monthly_customer_cohort_retention
[0m20:35:03.908306 [info ] [Thread-4 (]: 7 of 8 START sql table model `reporting`.`mart_customer_revenue` ............... [RUN]
[0m20:35:03.910437 [info ] [Thread-1 (]: 8 of 8 START sql table model `reporting`.`monthly_customer_cohort_retention` ... [RUN]
[0m20:35:03.913739 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_order_reviews, now model.olist_dbt.mart_customer_revenue)
[0m20:35:03.915581 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_orders, now model.olist_dbt.monthly_customer_cohort_retention)
[0m20:35:03.917156 [debug] [Thread-4 (]: Began compiling node model.olist_dbt.mart_customer_revenue
[0m20:35:03.922044 [debug] [Thread-1 (]: Began compiling node model.olist_dbt.monthly_customer_cohort_retention
[0m20:35:03.946062 [debug] [Thread-4 (]: Writing injected SQL for node "model.olist_dbt.mart_customer_revenue"
[0m20:35:03.951482 [debug] [Thread-1 (]: Writing injected SQL for node "model.olist_dbt.monthly_customer_cohort_retention"
[0m20:35:03.960981 [debug] [Thread-4 (]: Began executing node model.olist_dbt.mart_customer_revenue
[0m20:35:03.987861 [debug] [Thread-1 (]: Began executing node model.olist_dbt.monthly_customer_cohort_retention
[0m20:35:04.082134 [debug] [Thread-1 (]: Creating new relation monthly_customer_cohort_retention
[0m20:35:04.191376 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

            

    
        create table `reporting`.`mart_customer_revenue__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (customer_unique_id)
        
        
        
        
                    -- end_of_sql
                    SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

                    
            empty
          as (
            

select
    assumeNotNull(c.customer_unique_id) as customer_unique_id ,
    c.customer_state,
    min(o.order_purchase_timestamp) as first_order_date,
    max(o.order_purchase_timestamp) as last_order_date,
    count(o.order_id) as number_of_orders,
    sum(o.total_amount) as total_revenue
from `reporting`.`fct_orders` o
join `intermediate`.`stg_customers` c on o.customer_id = c.customer_id
group by 1, 2
order by total_revenue desc
          )
        ...
[0m20:35:04.197073 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.monthly_customer_cohort_retention: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.monthly_customer_cohort_retention"} */

            

    
        create table `reporting`.`monthly_customer_cohort_retention`
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            -- dbt/dbt_project/models/marts/monthly_customer_cohort_retention.sql


with orders as (
    select
        customer_id,
        toDate(order_purchase_timestamp) as order_date,
        toStartOfMonth(toDate(order_purchase_timestamp)) as order_month
    from `reporting`.`fct_orders`
    where customer_id is not null
),

customer_cohorts as (
    select
        customer_id,
        min(order_date) as first_order_date,
        toStartOfMonth(min(order_date)) as cohort_month
    from orders
    group by customer_id
),

subsequent_orders as (
    select distinct
        customer_id,
        order_month
    from orders
),

cohort_activity as (
    select
        c.customer_id,
        c.cohort_month,
        s.order_month,
        dateDiff('month', c.cohort_month, s.order_month) as month_number
    from customer_cohorts c
    join subsequent_orders s 
      on c.customer_id = s.customer_id
    where dateDiff('month', c.cohort_month, s.order_month) >= 0
),

cohort_size as (
    select
        cohort_month,
        countDistinct(customer_id) as total_customers
    from customer_cohorts
    group by cohort_month
),

monthly_active_customers as (
    select
        cohort_month,
        month_number,
        countDistinct(customer_id) as active_customers
    from cohort_activity
    group by cohort_month, month_number
)

select
    m.cohort_month,
    m.month_number,
    s.total_customers,
    m.active_customers,
    if(s.total_customers > 0, round(m.active_customers * 100.0 / s.total_customers, 2), null) as retention_rate
from monthly_active_customers m
join cohort_size s
  on m.cohort_month = s.cohort_month
order by
    m.cohort_month, m.month_number;
          )
        ...
[0m20:35:04.204245 [debug] [Thread-1 (]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.monthly_customer_cohort_retention"} */

            

    
        create table `reporting`.`monthly_customer_cohort_retention`
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            -- dbt/dbt_project/models/marts/monthly_customer_cohort_retention.sql


with orders as (
    select
        customer_id,
        toDate(order_purchase_timestamp) as order_date,
        toStartOfMonth(toDate(order_purchase_timestamp)) as order_month
    from `reporting`.`fct_orders`
    where customer_id is not null
),

customer_cohorts as (
    select
        customer_id,
        min(order_date) as first_order_date,
        toStartOfMonth(min(order_date)) as cohort_month
    from orders
    group by customer_id
),

subsequent_orders as (
    select distinct
        customer_id,
        order_month
    from orders
),

cohort_activity as (
    select
        c.customer_id,
        c.cohort_month,
        s.order_month,
        dateDiff('month', c.cohort_month, s.order_month) as month_number
    from customer_cohorts c
    join subsequent_orders s 
      on c.customer_id = s.customer_id
    where dateDiff('month', c.cohort_month, s.order_month) >= 0
),

cohort_size as (
    select
        cohort_month,
        countDistinct(customer_id) as total_customers
    from customer_cohorts
    group by cohort_month
),

monthly_active_customers as (
    select
        cohort_month,
        month_number,
        countDistinct(customer_id) as active_customers
    from cohort_activity
    group by cohort_month, month_number
)

select
    m.cohort_month,
    m.month_number,
    s.total_customers,
    m.active_customers,
    if(s.total_customers > 0, round(m.active_customers * 100.0 / s.total_customers, 2), null) as retention_rate
from monthly_active_customers m
join cohort_size s
  on m.cohort_month = s.cohort_month
order by
    m.cohort_month, m.month_number;
          )
        
[0m20:35:04.212898 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:04.227324 [debug] [Thread-1 (]: Database Error in model monthly_customer_cohort_retention (models/marts/monthly_customer_cohort_retention.sql)
  HTTPDriver for http://clickhouse-server:8123 received ClickHouse error code 62
   Code: 62. DB::Exception: Syntax error: failed at position 2199 (end of query) (line 90, col 35): ;
            )
          . Expected one of: token, Dot, OR, AND, IS NOT DISTINCT FROM, IS NULL, IS NOT NULL, BETWEEN, NOT BETWEEN, LIKE, ILIKE, NOT LIKE, NOT ILIKE, REGEXP, IN, NOT IN, GLOBAL IN, GLOBAL NOT IN, MOD, DIV, alias, AS, Comma, LIMIT, OFFSET, FETCH, SETTINGS, UNION, EXCEPT, INTERSECT. (SYNTAX_ERROR) (version 23.8.16.16 (official build))
[0m20:35:04.232805 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

    select name, type from system.columns where table = 'mart_customer_revenue__dbt_backup'
    
      and database = 'reporting'
    
    order by position
  ...
[0m20:35:04.234036 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99ceaaf8-12a3-472f-a5fe-a29222eb314a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b249b6300>]}
[0m20:35:04.238159 [error] [Thread-1 (]: 8 of 8 ERROR creating sql table model `reporting`.`monthly_customer_cohort_retention`  [[31mERROR[0m in 0.32s]
[0m20:35:04.241794 [debug] [Thread-1 (]: Finished running node model.olist_dbt.monthly_customer_cohort_retention
[0m20:35:04.246671 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:04.252092 [debug] [Thread-4 (]: Writing runtime sql for node "model.olist_dbt.mart_customer_revenue"
[0m20:35:04.266309 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

  
    
    
    
        
        insert into `reporting`.`mart_customer_revenue__dbt_backup`
        ("customer_unique_id", "customer_state", "first_order_date", "last_order_date", "number_of_orders", "total_revenue")

select
    assumeNotNull(c.customer_unique_id) as customer_unique_id ,
    c.customer_state,
    min(o.order_purchase_timestamp) as first_order_date,
    max(o.order_purchase_timestamp) as last_order_date,
    count(o.order_id) as number_of_orders,
    sum(o.total_amount) as total_revenue
from `reporting`.`fct_orders` o
join `intermediate`.`stg_customers` c on o.customer_id = c.customer_id
group by 1, 2
order by total_revenue desc
  ...
[0m20:35:04.641780 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.37 seconds
[0m20:35:04.658895 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */
EXCHANGE TABLES `reporting`.`mart_customer_revenue__dbt_backup` AND `reporting`.`mart_customer_revenue` 
  
  ...
[0m20:35:04.664970 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:35:04.676346 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

    drop table if exists `reporting`.`mart_customer_revenue__dbt_backup` 
  ...
[0m20:35:04.684513 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:35:04.688873 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '99ceaaf8-12a3-472f-a5fe-a29222eb314a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b24853a10>]}
[0m20:35:04.691030 [info ] [Thread-4 (]: 7 of 8 OK created sql table model `reporting`.`mart_customer_revenue` .......... [[32mOK[0m in 0.78s]
[0m20:35:04.693367 [debug] [Thread-4 (]: Finished running node model.olist_dbt.mart_customer_revenue
[0m20:35:04.698280 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:35:04.699246 [debug] [MainThread]: Connection 'model.olist_dbt.fct_orders' was left open.
[0m20:35:04.700135 [debug] [MainThread]: On model.olist_dbt.fct_orders: Close
[0m20:35:04.700880 [debug] [MainThread]: Connection 'model.olist_dbt.monthly_customer_cohort_retention' was left open.
[0m20:35:04.701884 [debug] [MainThread]: On model.olist_dbt.monthly_customer_cohort_retention: Close
[0m20:35:04.702850 [debug] [MainThread]: Connection 'model.olist_dbt.stg_order_payments' was left open.
[0m20:35:04.703761 [debug] [MainThread]: On model.olist_dbt.stg_order_payments: Close
[0m20:35:04.704388 [debug] [MainThread]: Connection 'model.olist_dbt.mart_customer_revenue' was left open.
[0m20:35:04.705043 [debug] [MainThread]: On model.olist_dbt.mart_customer_revenue: Close
[0m20:35:04.706371 [info ] [MainThread]: 
[0m20:35:04.707332 [info ] [MainThread]: Finished running 5 view models, 1 incremental model, 2 table models in 0 hours 0 minutes and 2.72 seconds (2.72s).
[0m20:35:04.712700 [debug] [MainThread]: Command end result
[0m20:35:04.818957 [info ] [MainThread]: 
[0m20:35:04.820002 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:35:04.821253 [info ] [MainThread]: 
[0m20:35:04.823115 [error] [MainThread]:   Database Error in model monthly_customer_cohort_retention (models/marts/monthly_customer_cohort_retention.sql)
  HTTPDriver for http://clickhouse-server:8123 received ClickHouse error code 62
   Code: 62. DB::Exception: Syntax error: failed at position 2199 (end of query) (line 90, col 35): ;
            )
          . Expected one of: token, Dot, OR, AND, IS NOT DISTINCT FROM, IS NULL, IS NOT NULL, BETWEEN, NOT BETWEEN, LIKE, ILIKE, NOT LIKE, NOT ILIKE, REGEXP, IN, NOT IN, GLOBAL IN, GLOBAL NOT IN, MOD, DIV, alias, AS, Comma, LIMIT, OFFSET, FETCH, SETTINGS, UNION, EXCEPT, INTERSECT. (SYNTAX_ERROR) (version 23.8.16.16 (official build))
[0m20:35:04.824558 [info ] [MainThread]: 
[0m20:35:04.826376 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=1 SKIP=0 TOTAL=8
[0m20:35:04.829667 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 8.43754, "process_in_blocks": "0", "process_kernel_time": 0.531217, "process_mem_max_rss": "126232", "process_out_blocks": "136", "process_user_time": 9.766234}
[0m20:35:04.830871 [debug] [MainThread]: Command `dbt run` failed at 20:35:04.830661 after 8.44 seconds
[0m20:35:04.831826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b271d7920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b27e72f00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3b27c58a10>]}
[0m20:35:04.832658 [debug] [MainThread]: Flushing usage events
[0m20:39:15.069971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c65ec1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c545ea20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c65ef140>]}


============================== 20:39:15.075187 | 4a408d92-1d69-4561-99b0-2f38919a679c ==============================
[0m20:39:15.075187 [info ] [MainThread]: Running with dbt=1.8.9
[0m20:39:15.076956 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/dbt_project/logs', 'version_check': 'True', 'profiles_dir': '.', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir .', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:39:15.466544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4a408d92-1d69-4561-99b0-2f38919a679c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c497f050>]}
[0m20:39:15.601309 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4a408d92-1d69-4561-99b0-2f38919a679c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c49c7e00>]}
[0m20:39:15.604482 [info ] [MainThread]: Registered adapter: clickhouse=1.8.0
[0m20:39:15.782595 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m20:39:16.273127 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:39:16.274505 [debug] [MainThread]: Partial parsing: updated file: olist_dbt://models/marts/monthly_customer_cohort_retention.sql
[0m20:39:16.674553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4a408d92-1d69-4561-99b0-2f38919a679c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c4161910>]}
[0m20:39:16.908075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4a408d92-1d69-4561-99b0-2f38919a679c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c413f170>]}
[0m20:39:16.909615 [info ] [MainThread]: Found 8 models, 5 sources, 464 macros
[0m20:39:16.911211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4a408d92-1d69-4561-99b0-2f38919a679c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c4141880>]}
[0m20:39:16.922070 [info ] [MainThread]: 
[0m20:39:16.924322 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m20:39:16.946309 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m20:39:16.947989 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m20:39:16.990254 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:39:16.991270 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:39:17.138725 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m20:39:17.145028 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:39:17.174574 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m20:39:17.188090 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:39:17.196404 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__intermediate)
[0m20:39:17.197387 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__reporting)
[0m20:39:17.215126 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__intermediate: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list__intermediate"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'intermediate'
      

  ...
[0m20:39:17.224354 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__reporting: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list__reporting"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'reporting'
      

  ...
[0m20:39:17.235852 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:39:17.237861 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m20:39:17.248980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4a408d92-1d69-4561-99b0-2f38919a679c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c25244d0>]}
[0m20:39:17.251101 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:39:17.252641 [info ] [MainThread]: 
[0m20:39:17.261191 [debug] [Thread-1 (]: Began running node model.olist_dbt.stg_customers
[0m20:39:17.263406 [debug] [Thread-2 (]: Began running node model.olist_dbt.stg_order_items
[0m20:39:17.264908 [debug] [Thread-3 (]: Began running node model.olist_dbt.stg_order_payments
[0m20:39:17.267725 [debug] [Thread-4 (]: Began running node model.olist_dbt.stg_order_reviews
[0m20:39:17.266452 [info ] [Thread-1 (]: 1 of 8 START sql view model `intermediate`.`stg_customers` ..................... [RUN]
[0m20:39:17.270129 [info ] [Thread-2 (]: 2 of 8 START sql view model `intermediate`.`stg_order_items` ................... [RUN]
[0m20:39:17.272227 [info ] [Thread-3 (]: 3 of 8 START sql view model `intermediate`.`stg_order_payments` ................ [RUN]
[0m20:39:17.274593 [info ] [Thread-4 (]: 4 of 8 START sql view model `intermediate`.`stg_order_reviews` ................. [RUN]
[0m20:39:17.276563 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__intermediate, now model.olist_dbt.stg_customers)
[0m20:39:17.278394 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list__reporting, now model.olist_dbt.stg_order_items)
[0m20:39:17.280768 [debug] [Thread-3 (]: Acquiring new clickhouse connection 'model.olist_dbt.stg_order_payments'
[0m20:39:17.282663 [debug] [Thread-4 (]: Acquiring new clickhouse connection 'model.olist_dbt.stg_order_reviews'
[0m20:39:17.284152 [debug] [Thread-1 (]: Began compiling node model.olist_dbt.stg_customers
[0m20:39:17.285314 [debug] [Thread-2 (]: Began compiling node model.olist_dbt.stg_order_items
[0m20:39:17.286545 [debug] [Thread-3 (]: Began compiling node model.olist_dbt.stg_order_payments
[0m20:39:17.287473 [debug] [Thread-4 (]: Began compiling node model.olist_dbt.stg_order_reviews
[0m20:39:17.306422 [debug] [Thread-2 (]: Writing injected SQL for node "model.olist_dbt.stg_order_items"
[0m20:39:17.310534 [debug] [Thread-1 (]: Writing injected SQL for node "model.olist_dbt.stg_customers"
[0m20:39:17.316302 [debug] [Thread-3 (]: Writing injected SQL for node "model.olist_dbt.stg_order_payments"
[0m20:39:17.322599 [debug] [Thread-4 (]: Writing injected SQL for node "model.olist_dbt.stg_order_reviews"
[0m20:39:17.333319 [debug] [Thread-1 (]: Began executing node model.olist_dbt.stg_customers
[0m20:39:17.334661 [debug] [Thread-4 (]: Began executing node model.olist_dbt.stg_order_reviews
[0m20:39:17.354249 [debug] [Thread-2 (]: Began executing node model.olist_dbt.stg_order_items
[0m20:39:17.377154 [debug] [Thread-3 (]: Began executing node model.olist_dbt.stg_order_payments
[0m20:39:17.583977 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:39:17.593055 [debug] [Thread-2 (]: Writing runtime sql for node "model.olist_dbt.stg_order_items"
[0m20:39:17.594586 [debug] [Thread-1 (]: Writing runtime sql for node "model.olist_dbt.stg_customers"
[0m20:39:17.605788 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m20:39:17.620537 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */


  create view `intermediate`.`stg_order_items__dbt_tmp` 
  
    
    
  as (
    select
    order_id,
    order_item_id,
    product_id,
    seller_id,
    parseDateTimeBestEffortOrNull(shipping_limit_date) as shipping_limit_date,
    toFloat64OrNull(price) as price,
    toFloat64OrNull(freight_value) as freight_value,
    
    round(cast(toFloat64(price) as decimal(16, 2)), 2)
 as price_dollars
from `raw`.`olist_order_items_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m20:39:17.621947 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */


  create view `intermediate`.`stg_customers__dbt_tmp` 
  
    
    
  as (
    select
    customer_id,
    customer_unique_id,
    customer_zip_code_prefix,
    customer_city,
    customer_state
from `raw`.`olist_customers_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m20:39:17.645126 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:39:17.664586 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    drop table if exists `intermediate`.`stg_order_items__dbt_backup` 
  
  ...
[0m20:39:17.671018 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m20:39:17.679983 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:39:17.684200 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    drop table if exists `intermediate`.`stg_customers__dbt_backup` 
  
  ...
[0m20:39:17.688731 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    rename table `intermediate`.`stg_order_items` to `intermediate`.`stg_order_items__dbt_backup` 
  
  ...
[0m20:39:17.696824 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:39:17.698243 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:39:17.700736 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    rename table `intermediate`.`stg_customers` to `intermediate`.`stg_customers__dbt_backup` 
  
  ...
[0m20:39:17.711271 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    drop table if exists `intermediate`.`stg_order_items` 
  
  ...
[0m20:39:17.718860 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:39:17.720932 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:39:17.729624 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    drop table if exists `intermediate`.`stg_customers` 
  
  ...
[0m20:39:17.733040 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    rename table `intermediate`.`stg_order_items__dbt_tmp` to `intermediate`.`stg_order_items` 
  
  ...
[0m20:39:17.734696 [debug] [Thread-4 (]: Writing runtime sql for node "model.olist_dbt.stg_order_reviews"
[0m20:39:17.743604 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:39:17.756505 [debug] [Thread-3 (]: Writing runtime sql for node "model.olist_dbt.stg_order_payments"
[0m20:39:17.757856 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m20:39:17.786267 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    rename table `intermediate`.`stg_customers__dbt_tmp` to `intermediate`.`stg_customers` 
  
  ...
[0m20:39:17.792963 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */


  create view `intermediate`.`stg_order_reviews__dbt_tmp` 
  
    
    
  as (
    select
    review_id,
    order_id,
    toInt64OrNull(review_score) as review_score,
    review_comment_title,
    review_comment_message,
    parseDateTimeBestEffortOrNull(review_creation_date) as review_creation_date,
    parseDateTimeBestEffortOrNull(review_answer_timestamp) as review_answer_timestamp

from `raw`.`olist_order_reviews_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m20:39:17.809562 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */


  create view `intermediate`.`stg_order_payments__dbt_tmp` 
  
    
    
  as (
    select
    order_id,
    payment_sequential,
    payment_type,
    
    round(cast(toFloat64(payment_value) as decimal(16, 2)), 2)
 as payment_value_dollars
from `raw`.`olist_order_payments_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m20:39:17.810267 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    drop table if exists `intermediate`.`stg_order_items__dbt_backup` 
  ...
[0m20:39:17.811968 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:39:17.822755 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:39:17.823794 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:39:17.824706 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:39:17.825864 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    drop table if exists `intermediate`.`stg_customers__dbt_backup` 
  ...
[0m20:39:17.831801 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a408d92-1d69-4561-99b0-2f38919a679c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c6800320>]}
[0m20:39:17.837745 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    drop table if exists `intermediate`.`stg_order_reviews__dbt_backup` 
  
  ...
[0m20:39:17.844205 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    drop table if exists `intermediate`.`stg_order_payments__dbt_backup` 
  
  ...
[0m20:39:17.847241 [info ] [Thread-2 (]: 2 of 8 OK created sql view model `intermediate`.`stg_order_items` .............. [[32mOK[0m in 0.55s]
[0m20:39:17.848771 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:39:17.854443 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:39:17.855879 [debug] [Thread-2 (]: Finished running node model.olist_dbt.stg_order_items
[0m20:39:17.857006 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:39:17.860506 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a408d92-1d69-4561-99b0-2f38919a679c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c21025a0>]}
[0m20:39:17.863312 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    rename table `intermediate`.`stg_order_reviews` to `intermediate`.`stg_order_reviews__dbt_backup` 
  
  ...
[0m20:39:17.864507 [debug] [Thread-2 (]: Began running node model.olist_dbt.stg_orders
[0m20:39:17.866644 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    rename table `intermediate`.`stg_order_payments` to `intermediate`.`stg_order_payments__dbt_backup` 
  
  ...
[0m20:39:17.867978 [info ] [Thread-1 (]: 1 of 8 OK created sql view model `intermediate`.`stg_customers` ................ [[32mOK[0m in 0.58s]
[0m20:39:17.870914 [info ] [Thread-2 (]: 5 of 8 START sql view model `intermediate`.`stg_orders` ........................ [RUN]
[0m20:39:17.873975 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:39:17.875414 [debug] [Thread-1 (]: Finished running node model.olist_dbt.stg_customers
[0m20:39:17.876713 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:39:17.877627 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_order_items, now model.olist_dbt.stg_orders)
[0m20:39:17.884805 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    drop table if exists `intermediate`.`stg_order_reviews` 
  
  ...
[0m20:39:17.890861 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    drop table if exists `intermediate`.`stg_order_payments` 
  
  ...
[0m20:39:17.891729 [debug] [Thread-2 (]: Began compiling node model.olist_dbt.stg_orders
[0m20:39:17.896210 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:39:17.897510 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:39:17.902557 [debug] [Thread-2 (]: Writing injected SQL for node "model.olist_dbt.stg_orders"
[0m20:39:17.904932 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    rename table `intermediate`.`stg_order_reviews__dbt_tmp` to `intermediate`.`stg_order_reviews` 
  
  ...
[0m20:39:17.907224 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    rename table `intermediate`.`stg_order_payments__dbt_tmp` to `intermediate`.`stg_order_payments` 
  
  ...
[0m20:39:17.913163 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:39:17.921120 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    drop table if exists `intermediate`.`stg_order_reviews__dbt_backup` 
  ...
[0m20:39:17.922562 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:39:17.930896 [debug] [Thread-2 (]: Began executing node model.olist_dbt.stg_orders
[0m20:39:17.933535 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    drop table if exists `intermediate`.`stg_order_payments__dbt_backup` 
  ...
[0m20:39:17.940478 [debug] [Thread-2 (]: Writing runtime sql for node "model.olist_dbt.stg_orders"
[0m20:39:17.941927 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m20:39:17.948135 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a408d92-1d69-4561-99b0-2f38919a679c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c2223dd0>]}
[0m20:39:17.949884 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:39:17.951446 [info ] [Thread-4 (]: 4 of 8 OK created sql view model `intermediate`.`stg_order_reviews` ............ [[32mOK[0m in 0.67s]
[0m20:39:17.955903 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a408d92-1d69-4561-99b0-2f38919a679c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c2223260>]}
[0m20:39:17.958070 [debug] [Thread-4 (]: Finished running node model.olist_dbt.stg_order_reviews
[0m20:39:17.960185 [info ] [Thread-3 (]: 3 of 8 OK created sql view model `intermediate`.`stg_order_payments` ........... [[32mOK[0m in 0.68s]
[0m20:39:17.963051 [debug] [Thread-3 (]: Finished running node model.olist_dbt.stg_order_payments
[0m20:39:17.964207 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */


  create view `intermediate`.`stg_orders__dbt_tmp` 
  
    
    
  as (
    select
    order_id,
    customer_id,
    order_status,
    parseDateTimeBestEffortOrNull(order_purchase_timestamp) as order_purchase_timestamp,
    parseDateTimeBestEffortOrNull(order_approved_at) as order_approved_at,
    parseDateTimeBestEffortOrNull(order_delivered_carrier_date) as order_delivered_carrier_date,
    parseDateTimeBestEffortOrNull(order_delivered_customer_date) as order_delivered_customer_date,
    parseDateTimeBestEffortOrNull(order_estimated_delivery_date) as order_estimated_delivery_date
from `raw`.`olist_orders_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m20:39:17.972261 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:39:17.979182 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    drop table if exists `intermediate`.`stg_orders__dbt_backup` 
  
  ...
[0m20:39:17.982546 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:39:17.984846 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    rename table `intermediate`.`stg_orders` to `intermediate`.`stg_orders__dbt_backup` 
  
  ...
[0m20:39:17.987916 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:39:17.996853 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    drop table if exists `intermediate`.`stg_orders` 
  
  ...
[0m20:39:17.999830 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:39:18.002058 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    rename table `intermediate`.`stg_orders__dbt_tmp` to `intermediate`.`stg_orders` 
  
  ...
[0m20:39:18.005741 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:39:18.084875 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    drop table if exists `intermediate`.`stg_orders__dbt_backup` 
  ...
[0m20:39:18.088578 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:39:18.091700 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a408d92-1d69-4561-99b0-2f38919a679c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c5bb3cb0>]}
[0m20:39:18.093240 [info ] [Thread-2 (]: 5 of 8 OK created sql view model `intermediate`.`stg_orders` ................... [[32mOK[0m in 0.21s]
[0m20:39:18.095035 [debug] [Thread-2 (]: Finished running node model.olist_dbt.stg_orders
[0m20:39:18.097281 [debug] [Thread-1 (]: Began running node model.olist_dbt.fct_orders
[0m20:39:18.098559 [info ] [Thread-1 (]: 6 of 8 START sql incremental model `reporting`.`fct_orders` .................... [RUN]
[0m20:39:18.100240 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_customers, now model.olist_dbt.fct_orders)
[0m20:39:18.101723 [debug] [Thread-1 (]: Began compiling node model.olist_dbt.fct_orders
[0m20:39:18.122953 [debug] [Thread-1 (]: Writing injected SQL for node "model.olist_dbt.fct_orders"
[0m20:39:18.134255 [debug] [Thread-1 (]: Began executing node model.olist_dbt.fct_orders
[0m20:39:18.237183 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.fct_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.fct_orders"} */

    select name, type from system.columns where table = 'fct_orders'
    
      and database = 'reporting'
    
    order by position
  ...
[0m20:39:18.245144 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:39:18.251713 [debug] [Thread-1 (]: Writing runtime sql for node "model.olist_dbt.fct_orders"
[0m20:39:18.265390 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.fct_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.fct_orders"} */

        insert into `reporting`.`fct_orders`
        ("order_id", "customer_id", "order_status", "order_purchase_timestamp", "order_approved_at", "order_delivered_customer_date", "total_amount")-- sql


with order_payments as (
    select
        order_id,
        sum(toFloat64(payment_value_dollars)) as total_amount
    from `intermediate`.`stg_order_payments`
    group by 1
)

select
    o.order_id,
    o.customer_id,
    o.order_status,

    -- Always non-NULL DateTime for adapter's CAST('timestamp')
    ifNull(
      parseDateTimeBestEffortOrNull(nullIf(toString(o.order_purchase_timestamp), '')),
      toDateTime('1970-01-01 00:00:00')
    ) as order_purchase_timestamp,

    ifNull(
      parseDateTimeBestEffortOrNull(nullIf(toString(o.order_approved_at), '')),
      toDateTime('1970-01-01 00:00:00')
    ) as order_approved_at,

    ifNull(
      parseDateTimeBestEffortOrNull(nullIf(toString(o.order_delivered_customer_date), '')),
      toDateTime('1970-01-01 00:00:00')
    ) as order_delivered_customer_date,

    ifNull(op.total_amount, 0.0) as total_amount
from `intermediate`.`stg_orders` o
left join order_payments op on o.order_id = op.order_id


  where order_purchase_timestamp > (select max(order_purchase_timestamp) from `reporting`.`fct_orders`)

    ...
[0m20:39:18.412693 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.15 seconds
[0m20:39:18.417551 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a408d92-1d69-4561-99b0-2f38919a679c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c454f3e0>]}
[0m20:39:18.419104 [info ] [Thread-1 (]: 6 of 8 OK created sql incremental model `reporting`.`fct_orders` ............... [[32mOK[0m in 0.32s]
[0m20:39:18.421258 [debug] [Thread-1 (]: Finished running node model.olist_dbt.fct_orders
[0m20:39:18.424114 [debug] [Thread-3 (]: Began running node model.olist_dbt.mart_customer_revenue
[0m20:39:18.425257 [debug] [Thread-2 (]: Began running node model.olist_dbt.monthly_customer_cohort_retention
[0m20:39:18.426707 [info ] [Thread-3 (]: 7 of 8 START sql table model `reporting`.`mart_customer_revenue` ............... [RUN]
[0m20:39:18.428389 [info ] [Thread-2 (]: 8 of 8 START sql table model `reporting`.`monthly_customer_cohort_retention` ... [RUN]
[0m20:39:18.429969 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_order_payments, now model.olist_dbt.mart_customer_revenue)
[0m20:39:18.431470 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_orders, now model.olist_dbt.monthly_customer_cohort_retention)
[0m20:39:18.432545 [debug] [Thread-3 (]: Began compiling node model.olist_dbt.mart_customer_revenue
[0m20:39:18.433687 [debug] [Thread-2 (]: Began compiling node model.olist_dbt.monthly_customer_cohort_retention
[0m20:39:18.441877 [debug] [Thread-3 (]: Writing injected SQL for node "model.olist_dbt.mart_customer_revenue"
[0m20:39:18.448786 [debug] [Thread-2 (]: Writing injected SQL for node "model.olist_dbt.monthly_customer_cohort_retention"
[0m20:39:18.456114 [debug] [Thread-3 (]: Began executing node model.olist_dbt.mart_customer_revenue
[0m20:39:18.457198 [debug] [Thread-2 (]: Began executing node model.olist_dbt.monthly_customer_cohort_retention
[0m20:39:18.538200 [debug] [Thread-2 (]: Creating new relation monthly_customer_cohort_retention
[0m20:39:18.683980 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.monthly_customer_cohort_retention: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.monthly_customer_cohort_retention"} */

            

    
        create table `reporting`.`monthly_customer_cohort_retention`
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            -- dbt/dbt_project/models/marts/monthly_customer_cohort_retention.sql


with orders as (
    select
        customer_id,
        toDate(order_purchase_timestamp) as order_date,
        toStartOfMonth(toDate(order_purchase_timestamp)) as order_month
    from `reporting`.`fct_orders`
    where customer_id is not null
),

customer_cohorts as (
    select
        customer_id,
        min(order_date) as first_order_date,
        toStartOfMonth(min(order_date)) as cohort_month
    from orders
    group by customer_id
),

subsequent_orders as (
    select distinct
        customer_id,
        order_month
    from orders
),

cohort_activity as (
    select
        c.customer_id,
        c.cohort_month,
        s.order_month,
        dateDiff('month', c.cohort_month, s.order_month) as month_number
    from customer_cohorts c
    join subsequent_orders s 
      on c.customer_id = s.customer_id
    where dateDiff('month', c.cohort_month, s.order_month) >= 0
),

cohort_size as (
    select
        cohort_month,
        countDistinct(customer_id) as total_customers
    from customer_cohorts
    group by cohort_month
),

monthly_active_customers as (
    select
        cohort_month,
        month_number,
        countDistinct(customer_id) as active_customers
    from cohort_activity
    group by cohort_month, month_number
)

select
    m.cohort_month,
    m.month_number,
    s.total_customers,
    m.active_customers,
    if(s.total_customers > 0, round(m.active_customers * 100.0 / s.total_customers, 2), null) as retention_rate
from monthly_active_customers m
join cohort_size s
  on m.cohort_month = s.cohort_month
order by
    m.cohort_month, m.month_number
          )
        ...
[0m20:39:18.688324 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

            

    
        create table `reporting`.`mart_customer_revenue__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (customer_unique_id)
        
        
        
        
                    -- end_of_sql
                    SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

                    
            empty
          as (
            

select
    assumeNotNull(c.customer_unique_id) as customer_unique_id ,
    c.customer_state,
    min(o.order_purchase_timestamp) as first_order_date,
    max(o.order_purchase_timestamp) as last_order_date,
    count(o.order_id) as number_of_orders,
    sum(o.total_amount) as total_revenue
from `reporting`.`fct_orders` o
join `intermediate`.`stg_customers` c on o.customer_id = c.customer_id
group by 1, 2
order by total_revenue desc
          )
        ...
[0m20:39:18.708944 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m20:39:18.720041 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

    select name, type from system.columns where table = 'mart_customer_revenue__dbt_backup'
    
      and database = 'reporting'
    
    order by position
  ...
[0m20:39:18.728093 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:39:18.734576 [debug] [Thread-3 (]: Writing runtime sql for node "model.olist_dbt.mart_customer_revenue"
[0m20:39:18.736848 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m20:39:18.744708 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.monthly_customer_cohort_retention: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.monthly_customer_cohort_retention"} */

    select name, type from system.columns where table = 'monthly_customer_cohort_retention'
    
      and database = 'reporting'
    
    order by position
  ...
[0m20:39:18.751768 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m20:39:18.752785 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

  
    
    
    
        
        insert into `reporting`.`mart_customer_revenue__dbt_backup`
        ("customer_unique_id", "customer_state", "first_order_date", "last_order_date", "number_of_orders", "total_revenue")

select
    assumeNotNull(c.customer_unique_id) as customer_unique_id ,
    c.customer_state,
    min(o.order_purchase_timestamp) as first_order_date,
    max(o.order_purchase_timestamp) as last_order_date,
    count(o.order_id) as number_of_orders,
    sum(o.total_amount) as total_revenue
from `reporting`.`fct_orders` o
join `intermediate`.`stg_customers` c on o.customer_id = c.customer_id
group by 1, 2
order by total_revenue desc
  ...
[0m20:39:18.755777 [debug] [Thread-2 (]: Writing runtime sql for node "model.olist_dbt.monthly_customer_cohort_retention"
[0m20:39:18.769126 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.monthly_customer_cohort_retention: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.monthly_customer_cohort_retention"} */

  
    
    
    
        
        insert into `reporting`.`monthly_customer_cohort_retention`
        ("cohort_month", "month_number", "total_customers", "active_customers", "retention_rate")-- dbt/dbt_project/models/marts/monthly_customer_cohort_retention.sql


with orders as (
    select
        customer_id,
        toDate(order_purchase_timestamp) as order_date,
        toStartOfMonth(toDate(order_purchase_timestamp)) as order_month
    from `reporting`.`fct_orders`
    where customer_id is not null
),

customer_cohorts as (
    select
        customer_id,
        min(order_date) as first_order_date,
        toStartOfMonth(min(order_date)) as cohort_month
    from orders
    group by customer_id
),

subsequent_orders as (
    select distinct
        customer_id,
        order_month
    from orders
),

cohort_activity as (
    select
        c.customer_id,
        c.cohort_month,
        s.order_month,
        dateDiff('month', c.cohort_month, s.order_month) as month_number
    from customer_cohorts c
    join subsequent_orders s 
      on c.customer_id = s.customer_id
    where dateDiff('month', c.cohort_month, s.order_month) >= 0
),

cohort_size as (
    select
        cohort_month,
        countDistinct(customer_id) as total_customers
    from customer_cohorts
    group by cohort_month
),

monthly_active_customers as (
    select
        cohort_month,
        month_number,
        countDistinct(customer_id) as active_customers
    from cohort_activity
    group by cohort_month, month_number
)

select
    m.cohort_month,
    m.month_number,
    s.total_customers,
    m.active_customers,
    if(s.total_customers > 0, round(m.active_customers * 100.0 / s.total_customers, 2), null) as retention_rate
from monthly_active_customers m
join cohort_size s
  on m.cohort_month = s.cohort_month
order by
    m.cohort_month, m.month_number
  ...
[0m20:39:19.053727 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.28 seconds
[0m20:39:19.062255 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a408d92-1d69-4561-99b0-2f38919a679c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c210ca40>]}
[0m20:39:19.064379 [info ] [Thread-2 (]: 8 of 8 OK created sql table model `reporting`.`monthly_customer_cohort_retention`  [[32mOK[0m in 0.63s]
[0m20:39:19.066502 [debug] [Thread-2 (]: Finished running node model.olist_dbt.monthly_customer_cohort_retention
[0m20:39:19.132473 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.38 seconds
[0m20:39:19.141479 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */
EXCHANGE TABLES `reporting`.`mart_customer_revenue__dbt_backup` AND `reporting`.`mart_customer_revenue` 
  
  ...
[0m20:39:19.145685 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:39:19.152116 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

    drop table if exists `reporting`.`mart_customer_revenue__dbt_backup` 
  ...
[0m20:39:19.156159 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m20:39:19.158833 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4a408d92-1d69-4561-99b0-2f38919a679c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c210e420>]}
[0m20:39:19.160235 [info ] [Thread-3 (]: 7 of 8 OK created sql table model `reporting`.`mart_customer_revenue` .......... [[32mOK[0m in 0.73s]
[0m20:39:19.162429 [debug] [Thread-3 (]: Finished running node model.olist_dbt.mart_customer_revenue
[0m20:39:19.166996 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:39:19.168047 [debug] [MainThread]: Connection 'model.olist_dbt.fct_orders' was left open.
[0m20:39:19.169310 [debug] [MainThread]: On model.olist_dbt.fct_orders: Close
[0m20:39:19.170436 [debug] [MainThread]: Connection 'model.olist_dbt.monthly_customer_cohort_retention' was left open.
[0m20:39:19.171500 [debug] [MainThread]: On model.olist_dbt.monthly_customer_cohort_retention: Close
[0m20:39:19.172802 [debug] [MainThread]: Connection 'model.olist_dbt.mart_customer_revenue' was left open.
[0m20:39:19.173970 [debug] [MainThread]: On model.olist_dbt.mart_customer_revenue: Close
[0m20:39:19.175148 [debug] [MainThread]: Connection 'model.olist_dbt.stg_order_reviews' was left open.
[0m20:39:19.176425 [debug] [MainThread]: On model.olist_dbt.stg_order_reviews: Close
[0m20:39:19.179234 [info ] [MainThread]: 
[0m20:39:19.187082 [info ] [MainThread]: Finished running 5 view models, 1 incremental model, 2 table models in 0 hours 0 minutes and 2.26 seconds (2.26s).
[0m20:39:19.193010 [debug] [MainThread]: Command end result
[0m20:39:19.316766 [info ] [MainThread]: 
[0m20:39:19.317978 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:39:19.319206 [info ] [MainThread]: 
[0m20:39:19.320599 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
[0m20:39:19.323186 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.365033, "process_in_blocks": "0", "process_kernel_time": 0.22147, "process_mem_max_rss": "120652", "process_out_blocks": "0", "process_user_time": 6.030024}
[0m20:39:19.324609 [debug] [MainThread]: Command `dbt run` succeeded at 20:39:19.324380 after 4.37 seconds
[0m20:39:19.325637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c65ef140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c4e695b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa9c42293a0>]}
[0m20:39:19.326851 [debug] [MainThread]: Flushing usage events
[0m21:19:57.275449 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb88612210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb88612ea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb88613620>]}


============================== 21:19:57.287232 | 499290ff-d215-495e-8d60-8cf649f0f780 ==============================
[0m21:19:57.287232 [info ] [MainThread]: Running with dbt=1.8.9
[0m21:19:57.288819 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/usr/app/dbt/dbt_project/logs', 'profiles_dir': '.', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir .', 'send_anonymous_usage_stats': 'True'}
[0m21:19:57.738758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '499290ff-d215-495e-8d60-8cf649f0f780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb882da1b0>]}
[0m21:19:57.878036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '499290ff-d215-495e-8d60-8cf649f0f780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb8a2b8140>]}
[0m21:19:57.879845 [info ] [MainThread]: Registered adapter: clickhouse=1.8.0
[0m21:19:58.221535 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m21:19:58.953556 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 2 files added, 1 files changed.
[0m21:19:58.955268 [debug] [MainThread]: Partial parsing: added file: olist_dbt://models/staging/stg_products.sql
[0m21:19:58.956673 [debug] [MainThread]: Partial parsing: added file: olist_dbt://models/marts/mart_product_performance.sql
[0m21:19:58.959348 [debug] [MainThread]: Partial parsing: updated file: olist_dbt://models/sources.yml
[0m21:19:58.960766 [debug] [MainThread]: Partial parsing: deleted file: olist_dbt://models/marts/monthly_customer_cohort_retention.sql
[0m21:20:00.078449 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.olist_dbt.stg_products' (models/staging/stg_products.sql) depends on a source named 'raw_olist.olist_products_dataset' which was not found
[0m21:20:00.081323 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.95678, "process_in_blocks": "0", "process_kernel_time": 0.421614, "process_mem_max_rss": "107228", "process_out_blocks": "2864", "process_user_time": 6.535025}
[0m21:20:00.083435 [debug] [MainThread]: Command `dbt run` failed at 21:20:00.082993 after 2.96 seconds
[0m21:20:00.084946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb895c2c00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb87d33950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbb87e1cc20>]}
[0m21:20:00.087564 [debug] [MainThread]: Flushing usage events
[0m21:31:00.459275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a619896a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a6181f1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a6181f200>]}


============================== 21:31:00.476729 | 5d74f39e-d389-4ba4-9f4b-3a076301fb4a ==============================
[0m21:31:00.476729 [info ] [MainThread]: Running with dbt=1.8.9
[0m21:31:00.478469 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/dbt_project/logs', 'profiles_dir': '.', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir .', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:31:00.869680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5d74f39e-d389-4ba4-9f4b-3a076301fb4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a614c23c0>]}
[0m21:31:01.015127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5d74f39e-d389-4ba4-9f4b-3a076301fb4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a616030e0>]}
[0m21:31:01.016621 [info ] [MainThread]: Registered adapter: clickhouse=1.8.0
[0m21:31:01.208487 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m21:31:01.657060 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 2 files added, 1 files changed.
[0m21:31:01.658199 [debug] [MainThread]: Partial parsing: added file: olist_dbt://models/staging/stg_products.sql
[0m21:31:01.659169 [debug] [MainThread]: Partial parsing: added file: olist_dbt://models/marts/mart_product_performance.sql
[0m21:31:01.661601 [debug] [MainThread]: Partial parsing: updated file: olist_dbt://models/sources.yml
[0m21:31:01.662668 [debug] [MainThread]: Partial parsing: deleted file: olist_dbt://models/marts/monthly_customer_cohort_retention.sql
[0m21:31:02.538145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5d74f39e-d389-4ba4-9f4b-3a076301fb4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a60ee6720>]}
[0m21:31:02.784560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5d74f39e-d389-4ba4-9f4b-3a076301fb4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a612d7a70>]}
[0m21:31:02.785808 [info ] [MainThread]: Found 9 models, 6 sources, 464 macros
[0m21:31:02.787198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d74f39e-d389-4ba4-9f4b-3a076301fb4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a60243d10>]}
[0m21:31:02.792777 [info ] [MainThread]: 
[0m21:31:02.804364 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:31:02.817953 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m21:31:02.819103 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m21:31:02.848962 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:31:02.853296 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:31:02.981904 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m21:31:02.983243 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m21:31:02.987248 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:31:02.988603 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:31:03.017625 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__reporting)
[0m21:31:03.018828 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__intermediate)
[0m21:31:03.036571 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__reporting: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list__reporting"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'reporting'
      

  ...
[0m21:31:03.040529 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__intermediate: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list__intermediate"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'intermediate'
      

  ...
[0m21:31:03.047866 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.049234 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.056845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d74f39e-d389-4ba4-9f4b-3a076301fb4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a60e72b40>]}
[0m21:31:03.058085 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:31:03.058985 [info ] [MainThread]: 
[0m21:31:03.075935 [debug] [Thread-1 (]: Began running node model.olist_dbt.stg_customers
[0m21:31:03.076932 [debug] [Thread-2 (]: Began running node model.olist_dbt.stg_order_items
[0m21:31:03.078069 [debug] [Thread-3 (]: Began running node model.olist_dbt.stg_order_payments
[0m21:31:03.079003 [info ] [Thread-1 (]: 1 of 9 START sql view model `intermediate`.`stg_customers` ..................... [RUN]
[0m21:31:03.080300 [debug] [Thread-4 (]: Began running node model.olist_dbt.stg_order_reviews
[0m21:31:03.081585 [info ] [Thread-2 (]: 2 of 9 START sql view model `intermediate`.`stg_order_items` ................... [RUN]
[0m21:31:03.083343 [info ] [Thread-3 (]: 3 of 9 START sql view model `intermediate`.`stg_order_payments` ................ [RUN]
[0m21:31:03.085164 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__intermediate, now model.olist_dbt.stg_customers)
[0m21:31:03.086746 [info ] [Thread-4 (]: 4 of 9 START sql view model `intermediate`.`stg_order_reviews` ................. [RUN]
[0m21:31:03.088156 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list__reporting, now model.olist_dbt.stg_order_items)
[0m21:31:03.089750 [debug] [Thread-3 (]: Acquiring new clickhouse connection 'model.olist_dbt.stg_order_payments'
[0m21:31:03.091101 [debug] [Thread-1 (]: Began compiling node model.olist_dbt.stg_customers
[0m21:31:03.092761 [debug] [Thread-4 (]: Acquiring new clickhouse connection 'model.olist_dbt.stg_order_reviews'
[0m21:31:03.094549 [debug] [Thread-2 (]: Began compiling node model.olist_dbt.stg_order_items
[0m21:31:03.096733 [debug] [Thread-3 (]: Began compiling node model.olist_dbt.stg_order_payments
[0m21:31:03.109006 [debug] [Thread-4 (]: Began compiling node model.olist_dbt.stg_order_reviews
[0m21:31:03.113635 [debug] [Thread-1 (]: Writing injected SQL for node "model.olist_dbt.stg_customers"
[0m21:31:03.119458 [debug] [Thread-2 (]: Writing injected SQL for node "model.olist_dbt.stg_order_items"
[0m21:31:03.125646 [debug] [Thread-3 (]: Writing injected SQL for node "model.olist_dbt.stg_order_payments"
[0m21:31:03.131546 [debug] [Thread-4 (]: Writing injected SQL for node "model.olist_dbt.stg_order_reviews"
[0m21:31:03.139747 [debug] [Thread-1 (]: Began executing node model.olist_dbt.stg_customers
[0m21:31:03.140797 [debug] [Thread-4 (]: Began executing node model.olist_dbt.stg_order_reviews
[0m21:31:03.218697 [debug] [Thread-3 (]: Began executing node model.olist_dbt.stg_order_payments
[0m21:31:03.235624 [debug] [Thread-2 (]: Began executing node model.olist_dbt.stg_order_items
[0m21:31:03.301183 [debug] [Thread-2 (]: Writing runtime sql for node "model.olist_dbt.stg_order_items"
[0m21:31:03.305218 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:31:03.306333 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:31:03.312181 [debug] [Thread-1 (]: Writing runtime sql for node "model.olist_dbt.stg_customers"
[0m21:31:03.326593 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */


  create view `intermediate`.`stg_customers__dbt_tmp` 
  
    
    
  as (
    select
    customer_id,
    customer_unique_id,
    customer_zip_code_prefix,
    customer_city,
    customer_state
from `raw`.`olist_customers_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:31:03.328127 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */


  create view `intermediate`.`stg_order_items__dbt_tmp` 
  
    
    
  as (
    select
    order_id,
    order_item_id,
    product_id,
    seller_id,
    parseDateTimeBestEffortOrNull(shipping_limit_date) as shipping_limit_date,
    toFloat64OrNull(price) as price,
    toFloat64OrNull(freight_value) as freight_value,
    
    round(cast(toFloat64(price) as decimal(16, 2)), 2)
 as price_dollars
from `raw`.`olist_order_items_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:31:03.357830 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:31:03.366054 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:31:03.375319 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    drop table if exists `intermediate`.`stg_customers__dbt_backup` 
  
  ...
[0m21:31:03.388005 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    drop table if exists `intermediate`.`stg_order_items__dbt_backup` 
  
  ...
[0m21:31:03.394597 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.397122 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.404705 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    rename table `intermediate`.`stg_customers` to `intermediate`.`stg_customers__dbt_backup` 
  
  ...
[0m21:31:03.420341 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    rename table `intermediate`.`stg_order_items` to `intermediate`.`stg_order_items__dbt_backup` 
  
  ...
[0m21:31:03.429498 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.542990 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.12 seconds
[0m21:31:03.551407 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    drop table if exists `intermediate`.`stg_customers` 
  
  ...
[0m21:31:03.563894 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    drop table if exists `intermediate`.`stg_order_items` 
  
  ...
[0m21:31:03.575245 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.578847 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    rename table `intermediate`.`stg_customers__dbt_tmp` to `intermediate`.`stg_customers` 
  
  ...
[0m21:31:03.580686 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.584692 [debug] [Thread-4 (]: Writing runtime sql for node "model.olist_dbt.stg_order_reviews"
[0m21:31:03.588119 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    rename table `intermediate`.`stg_order_items__dbt_tmp` to `intermediate`.`stg_order_items` 
  
  ...
[0m21:31:03.590066 [debug] [Thread-3 (]: Writing runtime sql for node "model.olist_dbt.stg_order_payments"
[0m21:31:03.591586 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.606756 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.642905 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */


  create view `intermediate`.`stg_order_payments__dbt_tmp` 
  
    
    
  as (
    select
    order_id,
    payment_sequential,
    payment_type,
    
    round(cast(toFloat64(payment_value) as decimal(16, 2)), 2)
 as payment_value_dollars
from `raw`.`olist_order_payments_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:31:03.670373 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */


  create view `intermediate`.`stg_order_reviews__dbt_tmp` 
  
    
    
  as (
    select
    review_id,
    order_id,
    toInt64OrNull(review_score) as review_score,
    review_comment_title,
    review_comment_message,
    parseDateTimeBestEffortOrNull(review_creation_date) as review_creation_date,
    parseDateTimeBestEffortOrNull(review_answer_timestamp) as review_answer_timestamp

from `raw`.`olist_order_reviews_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:31:03.708020 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    drop table if exists `intermediate`.`stg_order_items__dbt_backup` 
  ...
[0m21:31:03.715844 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m21:31:03.713632 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    drop table if exists `intermediate`.`stg_customers__dbt_backup` 
  ...
[0m21:31:03.717591 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m21:31:03.723871 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.723017 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    drop table if exists `intermediate`.`stg_order_reviews__dbt_backup` 
  
  ...
[0m21:31:03.732335 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    drop table if exists `intermediate`.`stg_order_payments__dbt_backup` 
  
  ...
[0m21:31:03.739277 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.742732 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d74f39e-d389-4ba4-9f4b-3a076301fb4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a4aca4bc0>]}
[0m21:31:03.748347 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:31:03.753099 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d74f39e-d389-4ba4-9f4b-3a076301fb4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a4aca4410>]}
[0m21:31:03.754933 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.757278 [info ] [Thread-2 (]: 2 of 9 OK created sql view model `intermediate`.`stg_order_items` .............. [[32mOK[0m in 0.65s]
[0m21:31:03.761773 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    rename table `intermediate`.`stg_order_reviews` to `intermediate`.`stg_order_reviews__dbt_backup` 
  
  ...
[0m21:31:03.764168 [info ] [Thread-1 (]: 1 of 9 OK created sql view model `intermediate`.`stg_customers` ................ [[32mOK[0m in 0.67s]
[0m21:31:03.768186 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    rename table `intermediate`.`stg_order_payments` to `intermediate`.`stg_order_payments__dbt_backup` 
  
  ...
[0m21:31:03.770265 [debug] [Thread-2 (]: Finished running node model.olist_dbt.stg_order_items
[0m21:31:03.774363 [debug] [Thread-1 (]: Finished running node model.olist_dbt.stg_customers
[0m21:31:03.777394 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:31:03.780593 [debug] [Thread-2 (]: Began running node model.olist_dbt.stg_orders
[0m21:31:03.782985 [debug] [Thread-1 (]: Began running node model.olist_dbt.stg_products
[0m21:31:03.785364 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.798252 [info ] [Thread-2 (]: 5 of 9 START sql view model `intermediate`.`stg_orders` ........................ [RUN]
[0m21:31:03.801185 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    drop table if exists `intermediate`.`stg_order_reviews` 
  
  ...
[0m21:31:03.803480 [info ] [Thread-1 (]: 6 of 9 START sql view model `intermediate`.`stg_products` ...................... [RUN]
[0m21:31:03.814520 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    drop table if exists `intermediate`.`stg_order_payments` 
  
  ...
[0m21:31:03.815498 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_order_items, now model.olist_dbt.stg_orders)
[0m21:31:03.817876 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_customers, now model.olist_dbt.stg_products)
[0m21:31:03.819232 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:31:03.821402 [debug] [Thread-2 (]: Began compiling node model.olist_dbt.stg_orders
[0m21:31:03.822860 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:31:03.823683 [debug] [Thread-1 (]: Began compiling node model.olist_dbt.stg_products
[0m21:31:03.825983 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    rename table `intermediate`.`stg_order_reviews__dbt_tmp` to `intermediate`.`stg_order_reviews` 
  
  ...
[0m21:31:03.832260 [debug] [Thread-2 (]: Writing injected SQL for node "model.olist_dbt.stg_orders"
[0m21:31:03.834710 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    rename table `intermediate`.`stg_order_payments__dbt_tmp` to `intermediate`.`stg_order_payments` 
  
  ...
[0m21:31:03.840391 [debug] [Thread-1 (]: Writing injected SQL for node "model.olist_dbt.stg_products"
[0m21:31:03.845625 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:31:03.848193 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.861909 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    drop table if exists `intermediate`.`stg_order_reviews__dbt_backup` 
  ...
[0m21:31:03.873523 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    drop table if exists `intermediate`.`stg_order_payments__dbt_backup` 
  ...
[0m21:31:03.881361 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.882480 [debug] [Thread-2 (]: Began executing node model.olist_dbt.stg_orders
[0m21:31:03.888807 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d74f39e-d389-4ba4-9f4b-3a076301fb4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a613206e0>]}
[0m21:31:03.891159 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.897777 [debug] [Thread-1 (]: Began executing node model.olist_dbt.stg_products
[0m21:31:03.903345 [debug] [Thread-2 (]: Writing runtime sql for node "model.olist_dbt.stg_orders"
[0m21:31:03.905339 [info ] [Thread-4 (]: 4 of 9 OK created sql view model `intermediate`.`stg_order_reviews` ............ [[32mOK[0m in 0.80s]
[0m21:31:03.911754 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d74f39e-d389-4ba4-9f4b-3a076301fb4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a60e96210>]}
[0m21:31:03.919830 [debug] [Thread-1 (]: Creating new relation stg_products
[0m21:31:03.922139 [debug] [Thread-4 (]: Finished running node model.olist_dbt.stg_order_reviews
[0m21:31:03.924118 [info ] [Thread-3 (]: 3 of 9 OK created sql view model `intermediate`.`stg_order_payments` ........... [[32mOK[0m in 0.82s]
[0m21:31:03.927660 [debug] [Thread-1 (]: Writing runtime sql for node "model.olist_dbt.stg_products"
[0m21:31:03.930680 [debug] [Thread-3 (]: Finished running node model.olist_dbt.stg_order_payments
[0m21:31:03.934121 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */


  create view `intermediate`.`stg_orders__dbt_tmp` 
  
    
    
  as (
    select
    order_id,
    customer_id,
    order_status,
    parseDateTimeBestEffortOrNull(order_purchase_timestamp) as order_purchase_timestamp,
    parseDateTimeBestEffortOrNull(order_approved_at) as order_approved_at,
    parseDateTimeBestEffortOrNull(order_delivered_carrier_date) as order_delivered_carrier_date,
    parseDateTimeBestEffortOrNull(order_delivered_customer_date) as order_delivered_customer_date,
    parseDateTimeBestEffortOrNull(order_estimated_delivery_date) as order_estimated_delivery_date
from `raw`.`olist_orders_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:31:03.939304 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */


  create view `intermediate`.`stg_products` 
  
    
    
  as (
    select
    product_id,
    product_category_name,
    toInt64OrNull(product_name_lenght) as product_name_length,
    toInt64OrNull(product_description_lenght) as product_description_length,
    toInt64OrNull(product_photos_qty) as product_photos_qty,
    toFloat64OrNull(product_weight_g) as product_weight_g,
    toFloat64OrNull(product_length_cm) as product_length_cm,
    toFloat64OrNull(product_height_cm) as product_height_cm,
    toFloat64OrNull(product_width_cm) as product_width_cm

from `raw`.`olist_products_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:31:03.943328 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.953219 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    drop table if exists `intermediate`.`stg_orders__dbt_backup` 
  
  ...
[0m21:31:03.954443 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.959637 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d74f39e-d389-4ba4-9f4b-3a076301fb4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a60f16360>]}
[0m21:31:03.961486 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:03.963054 [info ] [Thread-1 (]: 6 of 9 OK created sql view model `intermediate`.`stg_products` ................. [[32mOK[0m in 0.14s]
[0m21:31:03.966507 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    rename table `intermediate`.`stg_orders` to `intermediate`.`stg_orders__dbt_backup` 
  
  ...
[0m21:31:03.968427 [debug] [Thread-1 (]: Finished running node model.olist_dbt.stg_products
[0m21:31:03.972856 [debug] [Thread-4 (]: Began running node model.olist_dbt.mart_product_performance
[0m21:31:03.974610 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:31:03.976500 [info ] [Thread-4 (]: 7 of 9 START sql table model `reporting`.`mart_product_performance` ............ [RUN]
[0m21:31:03.990556 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_order_reviews, now model.olist_dbt.mart_product_performance)
[0m21:31:03.992189 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    drop table if exists `intermediate`.`stg_orders` 
  
  ...
[0m21:31:03.993378 [debug] [Thread-4 (]: Began compiling node model.olist_dbt.mart_product_performance
[0m21:31:04.006549 [debug] [Thread-4 (]: Writing injected SQL for node "model.olist_dbt.mart_product_performance"
[0m21:31:04.008853 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:04.015296 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    rename table `intermediate`.`stg_orders__dbt_tmp` to `intermediate`.`stg_orders` 
  
  ...
[0m21:31:04.020220 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:31:04.032137 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    drop table if exists `intermediate`.`stg_orders__dbt_backup` 
  ...
[0m21:31:04.034588 [debug] [Thread-4 (]: Began executing node model.olist_dbt.mart_product_performance
[0m21:31:04.047346 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:04.056782 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d74f39e-d389-4ba4-9f4b-3a076301fb4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a616c3440>]}
[0m21:31:04.063537 [info ] [Thread-2 (]: 5 of 9 OK created sql view model `intermediate`.`stg_orders` ................... [[32mOK[0m in 0.24s]
[0m21:31:04.080577 [debug] [Thread-2 (]: Finished running node model.olist_dbt.stg_orders
[0m21:31:04.082140 [debug] [Thread-4 (]: Creating new relation mart_product_performance
[0m21:31:04.083673 [debug] [Thread-1 (]: Began running node model.olist_dbt.fct_orders
[0m21:31:04.095697 [info ] [Thread-1 (]: 8 of 9 START sql incremental model `reporting`.`fct_orders` .................... [RUN]
[0m21:31:04.108390 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_products, now model.olist_dbt.fct_orders)
[0m21:31:04.116402 [debug] [Thread-1 (]: Began compiling node model.olist_dbt.fct_orders
[0m21:31:04.165058 [debug] [Thread-1 (]: Writing injected SQL for node "model.olist_dbt.fct_orders"
[0m21:31:04.204110 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_product_performance: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_product_performance"} */

            

    
        create table `reporting`.`mart_product_performance`
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            with order_items as (
    select
        product_id,
        order_id,
        price,
        freight_value
    from `intermediate`.`stg_order_items`
),

order_reviews as (
    select
        order_id,
        review_score
    from `intermediate`.`stg_order_reviews`
),

-- Aggregate metrics from order items
product_metrics as (
    select
        product_id,
        count(distinct order_id) as total_orders,
        sum(price) as total_revenue,
        sum(freight_value) as total_freight_cost,
        count(order_id) as total_units_sold
    from order_items
    group by 1
),

-- Aggregate review scores, joining through order_items to link reviews to products
product_reviews as (
    select
        oi.product_id,
        avg(r.review_score) as average_review_score
    from order_items oi
    join order_reviews r on oi.order_id = r.order_id
    group by 1
)

select
    p.product_id,
    p.product_category_name,
    coalesce(pm.total_units_sold, 0) as total_units_sold,
    coalesce(pm.total_revenue, 0) as total_revenue,
    coalesce(pr.average_review_score, 0) as average_review_score
from `intermediate`.`stg_products` p
left join product_metrics pm on p.product_id = pm.product_id
left join product_reviews pr on p.product_id = pr.product_id
where pm.total_orders is not null -- Only include products that have been sold
order by total_revenue desc
          )
        ...
[0m21:31:04.208324 [debug] [Thread-1 (]: Began executing node model.olist_dbt.fct_orders
[0m21:31:04.268792 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m21:31:04.320795 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_product_performance: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_product_performance"} */

    select name, type from system.columns where table = 'mart_product_performance'
    
      and database = 'reporting'
    
    order by position
  ...
[0m21:31:04.326270 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.fct_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.fct_orders"} */

    select name, type from system.columns where table = 'fct_orders'
    
      and database = 'reporting'
    
    order by position
  ...
[0m21:31:04.332581 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:31:04.334589 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:31:04.341848 [debug] [Thread-4 (]: Writing runtime sql for node "model.olist_dbt.mart_product_performance"
[0m21:31:04.346649 [debug] [Thread-1 (]: Writing runtime sql for node "model.olist_dbt.fct_orders"
[0m21:31:04.356649 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_product_performance: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_product_performance"} */

  
    
    
    
        
        insert into `reporting`.`mart_product_performance`
        ("p.product_id", "p.product_category_name", "total_units_sold", "total_revenue", "average_review_score")with order_items as (
    select
        product_id,
        order_id,
        price,
        freight_value
    from `intermediate`.`stg_order_items`
),

order_reviews as (
    select
        order_id,
        review_score
    from `intermediate`.`stg_order_reviews`
),

-- Aggregate metrics from order items
product_metrics as (
    select
        product_id,
        count(distinct order_id) as total_orders,
        sum(price) as total_revenue,
        sum(freight_value) as total_freight_cost,
        count(order_id) as total_units_sold
    from order_items
    group by 1
),

-- Aggregate review scores, joining through order_items to link reviews to products
product_reviews as (
    select
        oi.product_id,
        avg(r.review_score) as average_review_score
    from order_items oi
    join order_reviews r on oi.order_id = r.order_id
    group by 1
)

select
    p.product_id,
    p.product_category_name,
    coalesce(pm.total_units_sold, 0) as total_units_sold,
    coalesce(pm.total_revenue, 0) as total_revenue,
    coalesce(pr.average_review_score, 0) as average_review_score
from `intermediate`.`stg_products` p
left join product_metrics pm on p.product_id = pm.product_id
left join product_reviews pr on p.product_id = pr.product_id
where pm.total_orders is not null -- Only include products that have been sold
order by total_revenue desc
  ...
[0m21:31:04.361867 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.fct_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.fct_orders"} */

        insert into `reporting`.`fct_orders`
        ("order_id", "customer_id", "order_status", "order_purchase_timestamp", "order_approved_at", "order_delivered_customer_date", "total_amount")-- sql


with order_payments as (
    select
        order_id,
        sum(toFloat64(payment_value_dollars)) as total_amount
    from `intermediate`.`stg_order_payments`
    group by 1
)

select
    o.order_id,
    o.customer_id,
    o.order_status,

    -- Always non-NULL DateTime for adapter's CAST('timestamp')
    ifNull(
      parseDateTimeBestEffortOrNull(nullIf(toString(o.order_purchase_timestamp), '')),
      toDateTime('1970-01-01 00:00:00')
    ) as order_purchase_timestamp,

    ifNull(
      parseDateTimeBestEffortOrNull(nullIf(toString(o.order_approved_at), '')),
      toDateTime('1970-01-01 00:00:00')
    ) as order_approved_at,

    ifNull(
      parseDateTimeBestEffortOrNull(nullIf(toString(o.order_delivered_customer_date), '')),
      toDateTime('1970-01-01 00:00:00')
    ) as order_delivered_customer_date,

    ifNull(op.total_amount, 0.0) as total_amount
from `intermediate`.`stg_orders` o
left join order_payments op on o.order_id = op.order_id


  where order_purchase_timestamp > (select max(order_purchase_timestamp) from `reporting`.`fct_orders`)

    ...
[0m21:31:04.522154 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.16 seconds
[0m21:31:04.526544 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d74f39e-d389-4ba4-9f4b-3a076301fb4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a600a00b0>]}
[0m21:31:04.528952 [info ] [Thread-1 (]: 8 of 9 OK created sql incremental model `reporting`.`fct_orders` ............... [[32mOK[0m in 0.42s]
[0m21:31:04.531346 [debug] [Thread-1 (]: Finished running node model.olist_dbt.fct_orders
[0m21:31:04.533686 [debug] [Thread-2 (]: Began running node model.olist_dbt.mart_customer_revenue
[0m21:31:04.535817 [info ] [Thread-2 (]: 9 of 9 START sql table model `reporting`.`mart_customer_revenue` ............... [RUN]
[0m21:31:04.542683 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_orders, now model.olist_dbt.mart_customer_revenue)
[0m21:31:04.544987 [debug] [Thread-2 (]: Began compiling node model.olist_dbt.mart_customer_revenue
[0m21:31:04.560419 [debug] [Thread-2 (]: Writing injected SQL for node "model.olist_dbt.mart_customer_revenue"
[0m21:31:04.574016 [debug] [Thread-2 (]: Began executing node model.olist_dbt.mart_customer_revenue
[0m21:31:04.585559 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

            

    
        create table `reporting`.`mart_customer_revenue__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (customer_unique_id)
        
        
        
        
                    -- end_of_sql
                    SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

                    
            empty
          as (
            

select
    assumeNotNull(c.customer_unique_id) as customer_unique_id ,
    c.customer_state,
    min(o.order_purchase_timestamp) as first_order_date,
    max(o.order_purchase_timestamp) as last_order_date,
    count(o.order_id) as number_of_orders,
    sum(o.total_amount) as total_revenue
from `reporting`.`fct_orders` o
join `intermediate`.`stg_customers` c on o.customer_id = c.customer_id
group by 1, 2
order by total_revenue desc
          )
        ...
[0m21:31:04.602014 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:04.607742 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

    select name, type from system.columns where table = 'mart_customer_revenue__dbt_backup'
    
      and database = 'reporting'
    
    order by position
  ...
[0m21:31:04.614047 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:31:04.617758 [debug] [Thread-2 (]: Writing runtime sql for node "model.olist_dbt.mart_customer_revenue"
[0m21:31:04.628608 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

  
    
    
    
        
        insert into `reporting`.`mart_customer_revenue__dbt_backup`
        ("customer_unique_id", "customer_state", "first_order_date", "last_order_date", "number_of_orders", "total_revenue")

select
    assumeNotNull(c.customer_unique_id) as customer_unique_id ,
    c.customer_state,
    min(o.order_purchase_timestamp) as first_order_date,
    max(o.order_purchase_timestamp) as last_order_date,
    count(o.order_id) as number_of_orders,
    sum(o.total_amount) as total_revenue
from `reporting`.`fct_orders` o
join `intermediate`.`stg_customers` c on o.customer_id = c.customer_id
group by 1, 2
order by total_revenue desc
  ...
[0m21:31:04.669146 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.31 seconds
[0m21:31:04.672721 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d74f39e-d389-4ba4-9f4b-3a076301fb4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a6008f380>]}
[0m21:31:04.674146 [info ] [Thread-4 (]: 7 of 9 OK created sql table model `reporting`.`mart_product_performance` ....... [[32mOK[0m in 0.68s]
[0m21:31:04.675996 [debug] [Thread-4 (]: Finished running node model.olist_dbt.mart_product_performance
[0m21:31:04.969596 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.34 seconds
[0m21:31:04.983178 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */
EXCHANGE TABLES `reporting`.`mart_customer_revenue__dbt_backup` AND `reporting`.`mart_customer_revenue` 
  
  ...
[0m21:31:04.993896 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:31:05.009479 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

    drop table if exists `reporting`.`mart_customer_revenue__dbt_backup` 
  ...
[0m21:31:05.016453 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:31:05.021437 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d74f39e-d389-4ba4-9f4b-3a076301fb4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a61307620>]}
[0m21:31:05.025638 [info ] [Thread-2 (]: 9 of 9 OK created sql table model `reporting`.`mart_customer_revenue` .......... [[32mOK[0m in 0.48s]
[0m21:31:05.030494 [debug] [Thread-2 (]: Finished running node model.olist_dbt.mart_customer_revenue
[0m21:31:05.038430 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:31:05.039652 [debug] [MainThread]: Connection 'model.olist_dbt.mart_customer_revenue' was left open.
[0m21:31:05.041427 [debug] [MainThread]: On model.olist_dbt.mart_customer_revenue: Close
[0m21:31:05.042883 [debug] [MainThread]: Connection 'model.olist_dbt.fct_orders' was left open.
[0m21:31:05.049510 [debug] [MainThread]: On model.olist_dbt.fct_orders: Close
[0m21:31:05.050840 [debug] [MainThread]: Connection 'model.olist_dbt.stg_order_payments' was left open.
[0m21:31:05.052290 [debug] [MainThread]: On model.olist_dbt.stg_order_payments: Close
[0m21:31:05.053484 [debug] [MainThread]: Connection 'model.olist_dbt.mart_product_performance' was left open.
[0m21:31:05.054983 [debug] [MainThread]: On model.olist_dbt.mart_product_performance: Close
[0m21:31:05.057223 [info ] [MainThread]: 
[0m21:31:05.058819 [info ] [MainThread]: Finished running 6 view models, 1 incremental model, 2 table models in 0 hours 0 minutes and 2.25 seconds (2.25s).
[0m21:31:05.065711 [debug] [MainThread]: Command end result
[0m21:31:05.197139 [info ] [MainThread]: 
[0m21:31:05.198412 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:31:05.199812 [info ] [MainThread]: 
[0m21:31:05.201660 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 TOTAL=9
[0m21:31:05.204144 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.911961, "process_in_blocks": "0", "process_kernel_time": 0.423686, "process_mem_max_rss": "121124", "process_out_blocks": "192", "process_user_time": 6.678112}
[0m21:31:05.205393 [debug] [MainThread]: Command `dbt run` succeeded at 21:31:05.205186 after 4.91 seconds
[0m21:31:05.206380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a627df260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a61c41340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1a61c40c80>]}
[0m21:31:05.207398 [debug] [MainThread]: Flushing usage events
[0m21:44:00.860188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e4888410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e3e0c7a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e49eb710>]}


============================== 21:44:00.872706 | 074f830e-dc40-4dcf-85de-06663e69eafc ==============================
[0m21:44:00.872706 [info ] [MainThread]: Running with dbt=1.8.9
[0m21:44:00.874174 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/dbt_project/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir .', 'send_anonymous_usage_stats': 'True'}
[0m21:44:01.205876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '074f830e-dc40-4dcf-85de-06663e69eafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e3828e00>]}
[0m21:44:01.348891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '074f830e-dc40-4dcf-85de-06663e69eafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e39d7da0>]}
[0m21:44:01.350262 [info ] [MainThread]: Registered adapter: clickhouse=1.8.0
[0m21:44:01.554328 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m21:44:02.086102 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:44:02.088113 [debug] [MainThread]: Partial parsing: updated file: olist_dbt://models/marts/mart_product_performance.sql
[0m21:44:02.569645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '074f830e-dc40-4dcf-85de-06663e69eafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e25f27e0>]}
[0m21:44:02.777892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '074f830e-dc40-4dcf-85de-06663e69eafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e257de80>]}
[0m21:44:02.779286 [info ] [MainThread]: Found 9 models, 6 sources, 464 macros
[0m21:44:02.780726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '074f830e-dc40-4dcf-85de-06663e69eafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e25b76e0>]}
[0m21:44:02.787231 [info ] [MainThread]: 
[0m21:44:02.790613 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:44:02.826098 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m21:44:02.827617 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m21:44:02.853554 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:44:02.863410 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:44:03.046945 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m21:44:03.055070 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m21:44:03.057161 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.067293 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.095083 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__intermediate)
[0m21:44:03.096332 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__reporting)
[0m21:44:03.111967 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__reporting: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list__reporting"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'reporting'
      

  ...
[0m21:44:03.112747 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__intermediate: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list__intermediate"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'intermediate'
      

  ...
[0m21:44:03.120253 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.125082 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.134236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '074f830e-dc40-4dcf-85de-06663e69eafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e3756de0>]}
[0m21:44:03.136101 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:44:03.138886 [info ] [MainThread]: 
[0m21:44:03.169492 [debug] [Thread-1 (]: Began running node model.olist_dbt.stg_customers
[0m21:44:03.170685 [debug] [Thread-2 (]: Began running node model.olist_dbt.stg_order_items
[0m21:44:03.172351 [debug] [Thread-3 (]: Began running node model.olist_dbt.stg_order_payments
[0m21:44:03.175609 [debug] [Thread-4 (]: Began running node model.olist_dbt.stg_order_reviews
[0m21:44:03.174144 [info ] [Thread-1 (]: 1 of 9 START sql view model `intermediate`.`stg_customers` ..................... [RUN]
[0m21:44:03.178048 [info ] [Thread-2 (]: 2 of 9 START sql view model `intermediate`.`stg_order_items` ................... [RUN]
[0m21:44:03.180829 [info ] [Thread-3 (]: 3 of 9 START sql view model `intermediate`.`stg_order_payments` ................ [RUN]
[0m21:44:03.183231 [info ] [Thread-4 (]: 4 of 9 START sql view model `intermediate`.`stg_order_reviews` ................. [RUN]
[0m21:44:03.185177 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__intermediate, now model.olist_dbt.stg_customers)
[0m21:44:03.187005 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list__reporting, now model.olist_dbt.stg_order_items)
[0m21:44:03.188456 [debug] [Thread-3 (]: Acquiring new clickhouse connection 'model.olist_dbt.stg_order_payments'
[0m21:44:03.189998 [debug] [Thread-4 (]: Acquiring new clickhouse connection 'model.olist_dbt.stg_order_reviews'
[0m21:44:03.191161 [debug] [Thread-1 (]: Began compiling node model.olist_dbt.stg_customers
[0m21:44:03.192244 [debug] [Thread-2 (]: Began compiling node model.olist_dbt.stg_order_items
[0m21:44:03.193275 [debug] [Thread-3 (]: Began compiling node model.olist_dbt.stg_order_payments
[0m21:44:03.194855 [debug] [Thread-4 (]: Began compiling node model.olist_dbt.stg_order_reviews
[0m21:44:03.215473 [debug] [Thread-1 (]: Writing injected SQL for node "model.olist_dbt.stg_customers"
[0m21:44:03.219521 [debug] [Thread-2 (]: Writing injected SQL for node "model.olist_dbt.stg_order_items"
[0m21:44:03.227702 [debug] [Thread-3 (]: Writing injected SQL for node "model.olist_dbt.stg_order_payments"
[0m21:44:03.235444 [debug] [Thread-4 (]: Writing injected SQL for node "model.olist_dbt.stg_order_reviews"
[0m21:44:03.244761 [debug] [Thread-2 (]: Began executing node model.olist_dbt.stg_order_items
[0m21:44:03.246221 [debug] [Thread-3 (]: Began executing node model.olist_dbt.stg_order_payments
[0m21:44:03.302189 [debug] [Thread-1 (]: Began executing node model.olist_dbt.stg_customers
[0m21:44:03.310309 [debug] [Thread-4 (]: Began executing node model.olist_dbt.stg_order_reviews
[0m21:44:03.482899 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:44:03.485010 [debug] [Thread-2 (]: Writing runtime sql for node "model.olist_dbt.stg_order_items"
[0m21:44:03.492049 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:44:03.498303 [debug] [Thread-1 (]: Writing runtime sql for node "model.olist_dbt.stg_customers"
[0m21:44:03.534983 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */


  create view `intermediate`.`stg_order_items__dbt_tmp` 
  
    
    
  as (
    select
    order_id,
    order_item_id,
    product_id,
    seller_id,
    parseDateTimeBestEffortOrNull(shipping_limit_date) as shipping_limit_date,
    toFloat64OrNull(price) as price,
    toFloat64OrNull(freight_value) as freight_value,
    
    round(cast(toFloat64(price) as decimal(16, 2)), 2)
 as price_dollars
from `raw`.`olist_order_items_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:44:03.538497 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */


  create view `intermediate`.`stg_customers__dbt_tmp` 
  
    
    
  as (
    select
    customer_id,
    customer_unique_id,
    customer_zip_code_prefix,
    customer_city,
    customer_state
from `raw`.`olist_customers_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:44:03.555425 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:44:03.556898 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.584199 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    drop table if exists `intermediate`.`stg_customers__dbt_backup` 
  
  ...
[0m21:44:03.585896 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    drop table if exists `intermediate`.`stg_order_items__dbt_backup` 
  
  ...
[0m21:44:03.595241 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.601190 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    rename table `intermediate`.`stg_customers` to `intermediate`.`stg_customers__dbt_backup` 
  
  ...
[0m21:44:03.602999 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.607866 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    rename table `intermediate`.`stg_order_items` to `intermediate`.`stg_order_items__dbt_backup` 
  
  ...
[0m21:44:03.610260 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.627372 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.630917 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    drop table if exists `intermediate`.`stg_customers` 
  
  ...
[0m21:44:03.640418 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    drop table if exists `intermediate`.`stg_order_items` 
  
  ...
[0m21:44:03.648916 [debug] [Thread-4 (]: Writing runtime sql for node "model.olist_dbt.stg_order_reviews"
[0m21:44:03.650450 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.652226 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.653989 [debug] [Thread-3 (]: Writing runtime sql for node "model.olist_dbt.stg_order_payments"
[0m21:44:03.656622 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    rename table `intermediate`.`stg_customers__dbt_tmp` to `intermediate`.`stg_customers` 
  
  ...
[0m21:44:03.659324 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    rename table `intermediate`.`stg_order_items__dbt_tmp` to `intermediate`.`stg_order_items` 
  
  ...
[0m21:44:03.664526 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */


  create view `intermediate`.`stg_order_reviews__dbt_tmp` 
  
    
    
  as (
    select
    review_id,
    order_id,
    toInt64OrNull(review_score) as review_score,
    review_comment_title,
    review_comment_message,
    parseDateTimeBestEffortOrNull(review_creation_date) as review_creation_date,
    parseDateTimeBestEffortOrNull(review_answer_timestamp) as review_answer_timestamp

from `raw`.`olist_order_reviews_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:44:03.667858 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:44:03.669106 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.697008 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */


  create view `intermediate`.`stg_order_payments__dbt_tmp` 
  
    
    
  as (
    select
    order_id,
    payment_sequential,
    payment_type,
    
    round(cast(toFloat64(payment_value) as decimal(16, 2)), 2)
 as payment_value_dollars
from `raw`.`olist_order_payments_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:44:03.726237 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:44:03.746400 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    drop table if exists `intermediate`.`stg_order_payments__dbt_backup` 
  
  ...
[0m21:44:03.760959 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m21:44:03.795292 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    drop table if exists `intermediate`.`stg_order_reviews__dbt_backup` 
  
  ...
[0m21:44:03.799303 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    drop table if exists `intermediate`.`stg_order_items__dbt_backup` 
  ...
[0m21:44:03.800840 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m21:44:03.805007 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    drop table if exists `intermediate`.`stg_customers__dbt_backup` 
  ...
[0m21:44:03.810290 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:44:03.813653 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    rename table `intermediate`.`stg_order_payments` to `intermediate`.`stg_order_payments__dbt_backup` 
  
  ...
[0m21:44:03.815339 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.819927 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    rename table `intermediate`.`stg_order_reviews` to `intermediate`.`stg_order_reviews__dbt_backup` 
  
  ...
[0m21:44:03.821589 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.831145 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '074f830e-dc40-4dcf-85de-06663e69eafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e42f06b0>]}
[0m21:44:03.834370 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.838206 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '074f830e-dc40-4dcf-85de-06663e69eafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e10a2e10>]}
[0m21:44:03.839411 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.840839 [info ] [Thread-2 (]: 2 of 9 OK created sql view model `intermediate`.`stg_order_items` .............. [[32mOK[0m in 0.64s]
[0m21:44:03.849132 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    drop table if exists `intermediate`.`stg_order_payments` 
  
  ...
[0m21:44:03.850569 [info ] [Thread-1 (]: 1 of 9 OK created sql view model `intermediate`.`stg_customers` ................ [[32mOK[0m in 0.65s]
[0m21:44:03.857621 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    drop table if exists `intermediate`.`stg_order_reviews` 
  
  ...
[0m21:44:03.859118 [debug] [Thread-2 (]: Finished running node model.olist_dbt.stg_order_items
[0m21:44:03.862010 [debug] [Thread-1 (]: Finished running node model.olist_dbt.stg_customers
[0m21:44:03.863298 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:44:03.865320 [debug] [Thread-2 (]: Began running node model.olist_dbt.stg_orders
[0m21:44:03.867023 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:44:03.867945 [debug] [Thread-1 (]: Began running node model.olist_dbt.stg_products
[0m21:44:03.870179 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    rename table `intermediate`.`stg_order_payments__dbt_tmp` to `intermediate`.`stg_order_payments` 
  
  ...
[0m21:44:03.871419 [info ] [Thread-2 (]: 5 of 9 START sql view model `intermediate`.`stg_orders` ........................ [RUN]
[0m21:44:03.874807 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    rename table `intermediate`.`stg_order_reviews__dbt_tmp` to `intermediate`.`stg_order_reviews` 
  
  ...
[0m21:44:03.876388 [info ] [Thread-1 (]: 6 of 9 START sql view model `intermediate`.`stg_products` ...................... [RUN]
[0m21:44:03.879976 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_order_items, now model.olist_dbt.stg_orders)
[0m21:44:03.881754 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:44:03.884136 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_customers, now model.olist_dbt.stg_products)
[0m21:44:03.885652 [debug] [Thread-2 (]: Began compiling node model.olist_dbt.stg_orders
[0m21:44:03.886919 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:44:03.894357 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    drop table if exists `intermediate`.`stg_order_payments__dbt_backup` 
  ...
[0m21:44:03.895374 [debug] [Thread-1 (]: Began compiling node model.olist_dbt.stg_products
[0m21:44:03.902239 [debug] [Thread-2 (]: Writing injected SQL for node "model.olist_dbt.stg_orders"
[0m21:44:03.909475 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    drop table if exists `intermediate`.`stg_order_reviews__dbt_backup` 
  ...
[0m21:44:03.917102 [debug] [Thread-1 (]: Writing injected SQL for node "model.olist_dbt.stg_products"
[0m21:44:03.918514 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.923606 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '074f830e-dc40-4dcf-85de-06663e69eafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e10913d0>]}
[0m21:44:03.925120 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.926284 [info ] [Thread-3 (]: 3 of 9 OK created sql view model `intermediate`.`stg_order_payments` ........... [[32mOK[0m in 0.74s]
[0m21:44:03.930398 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '074f830e-dc40-4dcf-85de-06663e69eafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e1090740>]}
[0m21:44:03.932281 [debug] [Thread-3 (]: Finished running node model.olist_dbt.stg_order_payments
[0m21:44:03.933160 [debug] [Thread-2 (]: Began executing node model.olist_dbt.stg_orders
[0m21:44:03.933769 [debug] [Thread-1 (]: Began executing node model.olist_dbt.stg_products
[0m21:44:03.934846 [info ] [Thread-4 (]: 4 of 9 OK created sql view model `intermediate`.`stg_order_reviews` ............ [[32mOK[0m in 0.74s]
[0m21:44:03.943348 [debug] [Thread-2 (]: Writing runtime sql for node "model.olist_dbt.stg_orders"
[0m21:44:03.950681 [debug] [Thread-1 (]: Writing runtime sql for node "model.olist_dbt.stg_products"
[0m21:44:03.951688 [debug] [Thread-4 (]: Finished running node model.olist_dbt.stg_order_reviews
[0m21:44:03.958609 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */


  create view `intermediate`.`stg_orders__dbt_tmp` 
  
    
    
  as (
    select
    order_id,
    customer_id,
    order_status,
    parseDateTimeBestEffortOrNull(order_purchase_timestamp) as order_purchase_timestamp,
    parseDateTimeBestEffortOrNull(order_approved_at) as order_approved_at,
    parseDateTimeBestEffortOrNull(order_delivered_carrier_date) as order_delivered_carrier_date,
    parseDateTimeBestEffortOrNull(order_delivered_customer_date) as order_delivered_customer_date,
    parseDateTimeBestEffortOrNull(order_estimated_delivery_date) as order_estimated_delivery_date
from `raw`.`olist_orders_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:44:03.962448 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */


  create view `intermediate`.`stg_products__dbt_tmp` 
  
    
    
  as (
    select
    product_id,
    product_category_name,
    toInt64OrNull(product_name_lenght) as product_name_length,
    toInt64OrNull(product_description_lenght) as product_description_length,
    toInt64OrNull(product_photos_qty) as product_photos_qty,
    toFloat64OrNull(product_weight_g) as product_weight_g,
    toFloat64OrNull(product_length_cm) as product_length_cm,
    toFloat64OrNull(product_height_cm) as product_height_cm,
    toFloat64OrNull(product_width_cm) as product_width_cm

from `raw`.`olist_products_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:44:03.968069 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.976001 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    drop table if exists `intermediate`.`stg_orders__dbt_backup` 
  
  ...
[0m21:44:03.977611 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.984953 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */

    drop table if exists `intermediate`.`stg_products__dbt_backup` 
  
  ...
[0m21:44:03.986244 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:03.989520 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    rename table `intermediate`.`stg_orders` to `intermediate`.`stg_orders__dbt_backup` 
  
  ...
[0m21:44:03.990866 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:44:03.994894 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */

    rename table `intermediate`.`stg_products` to `intermediate`.`stg_products__dbt_backup` 
  
  ...
[0m21:44:03.996269 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:44:04.005407 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    drop table if exists `intermediate`.`stg_orders` 
  
  ...
[0m21:44:04.006711 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:04.090629 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */

    drop table if exists `intermediate`.`stg_products` 
  
  ...
[0m21:44:04.091961 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m21:44:04.095694 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    rename table `intermediate`.`stg_orders__dbt_tmp` to `intermediate`.`stg_orders` 
  
  ...
[0m21:44:04.097134 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:44:04.101154 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */

    rename table `intermediate`.`stg_products__dbt_tmp` to `intermediate`.`stg_products` 
  
  ...
[0m21:44:04.102530 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:44:04.111226 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    drop table if exists `intermediate`.`stg_orders__dbt_backup` 
  ...
[0m21:44:04.112666 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:04.121391 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */

    drop table if exists `intermediate`.`stg_products__dbt_backup` 
  ...
[0m21:44:04.122688 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:04.127316 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '074f830e-dc40-4dcf-85de-06663e69eafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e06e0d40>]}
[0m21:44:04.128928 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:04.130037 [info ] [Thread-2 (]: 5 of 9 OK created sql view model `intermediate`.`stg_orders` ................... [[32mOK[0m in 0.25s]
[0m21:44:04.133998 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '074f830e-dc40-4dcf-85de-06663e69eafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e06f0fe0>]}
[0m21:44:04.135567 [debug] [Thread-2 (]: Finished running node model.olist_dbt.stg_orders
[0m21:44:04.137187 [info ] [Thread-1 (]: 6 of 9 OK created sql view model `intermediate`.`stg_products` ................. [[32mOK[0m in 0.25s]
[0m21:44:04.140012 [debug] [Thread-1 (]: Finished running node model.olist_dbt.stg_products
[0m21:44:04.141030 [debug] [Thread-3 (]: Began running node model.olist_dbt.fct_orders
[0m21:44:04.142500 [debug] [Thread-2 (]: Began running node model.olist_dbt.mart_product_performance
[0m21:44:04.143860 [info ] [Thread-3 (]: 7 of 9 START sql incremental model `reporting`.`fct_orders` .................... [RUN]
[0m21:44:04.146168 [info ] [Thread-2 (]: 8 of 9 START sql table model `reporting`.`mart_product_performance` ............ [RUN]
[0m21:44:04.147962 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_order_payments, now model.olist_dbt.fct_orders)
[0m21:44:04.149634 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_orders, now model.olist_dbt.mart_product_performance)
[0m21:44:04.150787 [debug] [Thread-3 (]: Began compiling node model.olist_dbt.fct_orders
[0m21:44:04.151946 [debug] [Thread-2 (]: Began compiling node model.olist_dbt.mart_product_performance
[0m21:44:04.175672 [debug] [Thread-2 (]: Writing injected SQL for node "model.olist_dbt.mart_product_performance"
[0m21:44:04.180878 [debug] [Thread-3 (]: Writing injected SQL for node "model.olist_dbt.fct_orders"
[0m21:44:04.188350 [debug] [Thread-2 (]: Began executing node model.olist_dbt.mart_product_performance
[0m21:44:04.195868 [debug] [Thread-3 (]: Began executing node model.olist_dbt.fct_orders
[0m21:44:04.239902 [debug] [Thread-2 (]: Creating new relation mart_product_performance
[0m21:44:04.350998 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.fct_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.fct_orders"} */

    select name, type from system.columns where table = 'fct_orders'
    
      and database = 'reporting'
    
    order by position
  ...
[0m21:44:04.364255 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_product_performance: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_product_performance"} */

            

    
        create table `reporting`.`mart_product_performance`
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            with order_items as (
    select
        product_id,
        order_id,
        price,
        freight_value
    from `intermediate`.`stg_order_items`
),

order_reviews as (
    select
        order_id,
        review_score
    from `intermediate`.`stg_order_reviews`
),

-- Aggregate metrics from order items
product_metrics as (
    select
        product_id,
        count(distinct order_id) as total_orders,
        sum(price) as total_revenue,
        sum(freight_value) as total_freight_cost,
        count(order_id) as total_units_sold
    from order_items
    group by 1
),

-- Aggregate review scores, joining through order_items to link reviews to products
product_reviews as (
    select
        oi.product_id,
        avg(r.review_score) as average_review_score
    from order_items oi
    join order_reviews r on oi.order_id = r.order_id
    group by 1
)

select
    p.product_id as product_id,
    p.product_category_name as product_category_name,
    coalesce(pm.total_units_sold, 0) as total_units_sold,
    coalesce(pm.total_revenue, 0) as total_revenue,
    coalesce(pr.average_review_score, 0) as average_review_score
from `intermediate`.`stg_products` p
left join product_metrics pm on p.product_id = pm.product_id
left join product_reviews pr on p.product_id = pr.product_id
where pm.total_orders is not null -- Only include products that have been sold
order by total_revenue desc
          )
        ...
[0m21:44:04.365881 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:04.376283 [debug] [Thread-3 (]: Writing runtime sql for node "model.olist_dbt.fct_orders"
[0m21:44:04.390348 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.fct_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.fct_orders"} */

        insert into `reporting`.`fct_orders`
        ("order_id", "customer_id", "order_status", "order_purchase_timestamp", "order_approved_at", "order_delivered_customer_date", "total_amount")-- sql


with order_payments as (
    select
        order_id,
        sum(toFloat64(payment_value_dollars)) as total_amount
    from `intermediate`.`stg_order_payments`
    group by 1
)

select
    o.order_id,
    o.customer_id,
    o.order_status,

    -- Always non-NULL DateTime for adapter's CAST('timestamp')
    ifNull(
      parseDateTimeBestEffortOrNull(nullIf(toString(o.order_purchase_timestamp), '')),
      toDateTime('1970-01-01 00:00:00')
    ) as order_purchase_timestamp,

    ifNull(
      parseDateTimeBestEffortOrNull(nullIf(toString(o.order_approved_at), '')),
      toDateTime('1970-01-01 00:00:00')
    ) as order_approved_at,

    ifNull(
      parseDateTimeBestEffortOrNull(nullIf(toString(o.order_delivered_customer_date), '')),
      toDateTime('1970-01-01 00:00:00')
    ) as order_delivered_customer_date,

    ifNull(op.total_amount, 0.0) as total_amount
from `intermediate`.`stg_orders` o
left join order_payments op on o.order_id = op.order_id


  where order_purchase_timestamp > (select max(order_purchase_timestamp) from `reporting`.`fct_orders`)

    ...
[0m21:44:04.401023 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m21:44:04.409984 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_product_performance: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_product_performance"} */

    select name, type from system.columns where table = 'mart_product_performance'
    
      and database = 'reporting'
    
    order by position
  ...
[0m21:44:04.416078 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:44:04.419910 [debug] [Thread-2 (]: Writing runtime sql for node "model.olist_dbt.mart_product_performance"
[0m21:44:04.432945 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_product_performance: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_product_performance"} */

  
    
    
    
        
        insert into `reporting`.`mart_product_performance`
        ("product_id", "product_category_name", "total_units_sold", "total_revenue", "average_review_score")with order_items as (
    select
        product_id,
        order_id,
        price,
        freight_value
    from `intermediate`.`stg_order_items`
),

order_reviews as (
    select
        order_id,
        review_score
    from `intermediate`.`stg_order_reviews`
),

-- Aggregate metrics from order items
product_metrics as (
    select
        product_id,
        count(distinct order_id) as total_orders,
        sum(price) as total_revenue,
        sum(freight_value) as total_freight_cost,
        count(order_id) as total_units_sold
    from order_items
    group by 1
),

-- Aggregate review scores, joining through order_items to link reviews to products
product_reviews as (
    select
        oi.product_id,
        avg(r.review_score) as average_review_score
    from order_items oi
    join order_reviews r on oi.order_id = r.order_id
    group by 1
)

select
    p.product_id as product_id,
    p.product_category_name as product_category_name,
    coalesce(pm.total_units_sold, 0) as total_units_sold,
    coalesce(pm.total_revenue, 0) as total_revenue,
    coalesce(pr.average_review_score, 0) as average_review_score
from `intermediate`.`stg_products` p
left join product_metrics pm on p.product_id = pm.product_id
left join product_reviews pr on p.product_id = pr.product_id
where pm.total_orders is not null -- Only include products that have been sold
order by total_revenue desc
  ...
[0m21:44:04.670652 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.28 seconds
[0m21:44:04.676014 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '074f830e-dc40-4dcf-85de-06663e69eafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e35cbf80>]}
[0m21:44:04.678631 [info ] [Thread-3 (]: 7 of 9 OK created sql incremental model `reporting`.`fct_orders` ............... [[32mOK[0m in 0.53s]
[0m21:44:04.681837 [debug] [Thread-3 (]: Finished running node model.olist_dbt.fct_orders
[0m21:44:04.684013 [debug] [Thread-1 (]: Began running node model.olist_dbt.mart_customer_revenue
[0m21:44:04.685851 [info ] [Thread-1 (]: 9 of 9 START sql table model `reporting`.`mart_customer_revenue` ............... [RUN]
[0m21:44:04.690727 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_products, now model.olist_dbt.mart_customer_revenue)
[0m21:44:04.692202 [debug] [Thread-1 (]: Began compiling node model.olist_dbt.mart_customer_revenue
[0m21:44:04.701197 [debug] [Thread-1 (]: Writing injected SQL for node "model.olist_dbt.mart_customer_revenue"
[0m21:44:04.714047 [debug] [Thread-1 (]: Began executing node model.olist_dbt.mart_customer_revenue
[0m21:44:04.724196 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

            

    
        create table `reporting`.`mart_customer_revenue__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (customer_unique_id)
        
        
        
        
                    -- end_of_sql
                    SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

                    
            empty
          as (
            

select
    assumeNotNull(c.customer_unique_id) as customer_unique_id ,
    c.customer_state,
    min(o.order_purchase_timestamp) as first_order_date,
    max(o.order_purchase_timestamp) as last_order_date,
    count(o.order_id) as number_of_orders,
    sum(o.total_amount) as total_revenue
from `reporting`.`fct_orders` o
join `intermediate`.`stg_customers` c on o.customer_id = c.customer_id
group by 1, 2
order by total_revenue desc
          )
        ...
[0m21:44:04.746496 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:44:04.756255 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

    select name, type from system.columns where table = 'mart_customer_revenue__dbt_backup'
    
      and database = 'reporting'
    
    order by position
  ...
[0m21:44:04.766598 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:44:04.772558 [debug] [Thread-1 (]: Writing runtime sql for node "model.olist_dbt.mart_customer_revenue"
[0m21:44:04.782687 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

  
    
    
    
        
        insert into `reporting`.`mart_customer_revenue__dbt_backup`
        ("customer_unique_id", "customer_state", "first_order_date", "last_order_date", "number_of_orders", "total_revenue")

select
    assumeNotNull(c.customer_unique_id) as customer_unique_id ,
    c.customer_state,
    min(o.order_purchase_timestamp) as first_order_date,
    max(o.order_purchase_timestamp) as last_order_date,
    count(o.order_id) as number_of_orders,
    sum(o.total_amount) as total_revenue
from `reporting`.`fct_orders` o
join `intermediate`.`stg_customers` c on o.customer_id = c.customer_id
group by 1, 2
order by total_revenue desc
  ...
[0m21:44:04.803179 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.37 seconds
[0m21:44:04.806725 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '074f830e-dc40-4dcf-85de-06663e69eafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e0fab2c0>]}
[0m21:44:04.808069 [info ] [Thread-2 (]: 8 of 9 OK created sql table model `reporting`.`mart_product_performance` ....... [[32mOK[0m in 0.66s]
[0m21:44:04.810208 [debug] [Thread-2 (]: Finished running node model.olist_dbt.mart_product_performance
[0m21:44:05.193596 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.41 seconds
[0m21:44:05.204608 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */
EXCHANGE TABLES `reporting`.`mart_customer_revenue__dbt_backup` AND `reporting`.`mart_customer_revenue` 
  
  ...
[0m21:44:05.208960 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:44:05.215890 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

    drop table if exists `reporting`.`mart_customer_revenue__dbt_backup` 
  ...
[0m21:44:05.219491 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:44:05.222678 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '074f830e-dc40-4dcf-85de-06663e69eafc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e3091220>]}
[0m21:44:05.225262 [info ] [Thread-1 (]: 9 of 9 OK created sql table model `reporting`.`mart_customer_revenue` .......... [[32mOK[0m in 0.53s]
[0m21:44:05.230951 [debug] [Thread-1 (]: Finished running node model.olist_dbt.mart_customer_revenue
[0m21:44:05.236119 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:44:05.237194 [debug] [MainThread]: Connection 'model.olist_dbt.mart_customer_revenue' was left open.
[0m21:44:05.238316 [debug] [MainThread]: On model.olist_dbt.mart_customer_revenue: Close
[0m21:44:05.239227 [debug] [MainThread]: Connection 'model.olist_dbt.mart_product_performance' was left open.
[0m21:44:05.240167 [debug] [MainThread]: On model.olist_dbt.mart_product_performance: Close
[0m21:44:05.241214 [debug] [MainThread]: Connection 'model.olist_dbt.fct_orders' was left open.
[0m21:44:05.242148 [debug] [MainThread]: On model.olist_dbt.fct_orders: Close
[0m21:44:05.243050 [debug] [MainThread]: Connection 'model.olist_dbt.stg_order_reviews' was left open.
[0m21:44:05.245813 [debug] [MainThread]: On model.olist_dbt.stg_order_reviews: Close
[0m21:44:05.248352 [info ] [MainThread]: 
[0m21:44:05.250867 [info ] [MainThread]: Finished running 6 view models, 1 incremental model, 2 table models in 0 hours 0 minutes and 2.46 seconds (2.46s).
[0m21:44:05.256512 [debug] [MainThread]: Command end result
[0m21:44:05.364028 [info ] [MainThread]: 
[0m21:44:05.365275 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:44:05.366728 [info ] [MainThread]: 
[0m21:44:05.368244 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 TOTAL=9
[0m21:44:05.371730 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.6286573, "process_in_blocks": "0", "process_kernel_time": 0.431912, "process_mem_max_rss": "122908", "process_out_blocks": "2976", "process_user_time": 6.40838}
[0m21:44:05.373249 [debug] [MainThread]: Command `dbt run` succeeded at 21:44:05.372907 after 4.63 seconds
[0m21:44:05.374675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e4ebce30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e3e3b950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb8e433e0f0>]}
[0m21:44:05.376044 [debug] [MainThread]: Flushing usage events
[0m21:57:32.821678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9f0c936b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9eff5c170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9f24b47d0>]}


============================== 21:57:32.839995 | d898ee7c-a8e6-48fc-8444-a647466c8412 ==============================
[0m21:57:32.839995 [info ] [MainThread]: Running with dbt=1.8.9
[0m21:57:32.842794 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/usr/app/dbt/dbt_project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir .', 'send_anonymous_usage_stats': 'True'}
[0m21:57:33.372317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd898ee7c-a8e6-48fc-8444-a647466c8412', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9efac0fb0>]}
[0m21:57:33.528471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd898ee7c-a8e6-48fc-8444-a647466c8412', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9efaa2480>]}
[0m21:57:33.529951 [info ] [MainThread]: Registered adapter: clickhouse=1.8.0
[0m21:57:33.763631 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m21:57:34.332209 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 2 files changed.
[0m21:57:34.333342 [debug] [MainThread]: Partial parsing: added file: olist_dbt://models/staging/stg_product_category_name_translation.sql
[0m21:57:34.334137 [debug] [MainThread]: Partial parsing: added file: olist_dbt://models/marts/mart_monthly_category_revenue.sql
[0m21:57:34.336068 [debug] [MainThread]: Partial parsing: updated file: olist_dbt://models/sources.yml
[0m21:57:34.336909 [debug] [MainThread]: Partial parsing: updated file: olist_dbt://models/marts/mart_product_performance.sql
[0m21:57:35.135471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd898ee7c-a8e6-48fc-8444-a647466c8412', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ef43aba0>]}
[0m21:57:35.358563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd898ee7c-a8e6-48fc-8444-a647466c8412', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ef7d7890>]}
[0m21:57:35.359458 [info ] [MainThread]: Found 11 models, 7 sources, 464 macros
[0m21:57:35.360443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd898ee7c-a8e6-48fc-8444-a647466c8412', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ef99ff20>]}
[0m21:57:35.364541 [info ] [MainThread]: 
[0m21:57:35.366589 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m21:57:35.391436 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m21:57:35.398335 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m21:57:35.452147 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:57:35.447142 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:57:35.656453 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m21:57:35.657798 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m21:57:35.662085 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:57:35.663492 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:57:35.694779 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__intermediate)
[0m21:57:35.696596 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__reporting)
[0m21:57:35.720118 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__intermediate: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list__intermediate"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'intermediate'
      

  ...
[0m21:57:35.732584 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__reporting: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list__reporting"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'reporting'
      

  ...
[0m21:57:35.739687 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:35.748168 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:35.753301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd898ee7c-a8e6-48fc-8444-a647466c8412', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9efb18830>]}
[0m21:57:35.754508 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:57:35.755676 [info ] [MainThread]: 
[0m21:57:35.776330 [debug] [Thread-1 (]: Began running node model.olist_dbt.stg_customers
[0m21:57:35.777340 [debug] [Thread-2 (]: Began running node model.olist_dbt.stg_order_items
[0m21:57:35.778465 [debug] [Thread-3 (]: Began running node model.olist_dbt.stg_order_payments
[0m21:57:35.780788 [debug] [Thread-4 (]: Began running node model.olist_dbt.stg_order_reviews
[0m21:57:35.779948 [info ] [Thread-1 (]: 1 of 11 START sql view model `intermediate`.`stg_customers` .................... [RUN]
[0m21:57:35.782826 [info ] [Thread-2 (]: 2 of 11 START sql view model `intermediate`.`stg_order_items` .................. [RUN]
[0m21:57:35.784989 [info ] [Thread-3 (]: 3 of 11 START sql view model `intermediate`.`stg_order_payments` ............... [RUN]
[0m21:57:35.786951 [info ] [Thread-4 (]: 4 of 11 START sql view model `intermediate`.`stg_order_reviews` ................ [RUN]
[0m21:57:35.788357 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__reporting, now model.olist_dbt.stg_customers)
[0m21:57:35.789922 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list__intermediate, now model.olist_dbt.stg_order_items)
[0m21:57:35.791484 [debug] [Thread-3 (]: Acquiring new clickhouse connection 'model.olist_dbt.stg_order_payments'
[0m21:57:35.792893 [debug] [Thread-4 (]: Acquiring new clickhouse connection 'model.olist_dbt.stg_order_reviews'
[0m21:57:35.794100 [debug] [Thread-1 (]: Began compiling node model.olist_dbt.stg_customers
[0m21:57:35.795353 [debug] [Thread-2 (]: Began compiling node model.olist_dbt.stg_order_items
[0m21:57:35.796388 [debug] [Thread-3 (]: Began compiling node model.olist_dbt.stg_order_payments
[0m21:57:35.797317 [debug] [Thread-4 (]: Began compiling node model.olist_dbt.stg_order_reviews
[0m21:57:35.817359 [debug] [Thread-1 (]: Writing injected SQL for node "model.olist_dbt.stg_customers"
[0m21:57:35.818631 [debug] [Thread-2 (]: Writing injected SQL for node "model.olist_dbt.stg_order_items"
[0m21:57:35.825196 [debug] [Thread-3 (]: Writing injected SQL for node "model.olist_dbt.stg_order_payments"
[0m21:57:35.833277 [debug] [Thread-4 (]: Writing injected SQL for node "model.olist_dbt.stg_order_reviews"
[0m21:57:35.855830 [debug] [Thread-1 (]: Began executing node model.olist_dbt.stg_customers
[0m21:57:35.862575 [debug] [Thread-4 (]: Began executing node model.olist_dbt.stg_order_reviews
[0m21:57:35.970071 [debug] [Thread-3 (]: Began executing node model.olist_dbt.stg_order_payments
[0m21:57:35.990909 [debug] [Thread-2 (]: Began executing node model.olist_dbt.stg_order_items
[0m21:57:36.043321 [debug] [Thread-2 (]: Writing runtime sql for node "model.olist_dbt.stg_order_items"
[0m21:57:36.045178 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:57:36.048164 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:57:36.050664 [debug] [Thread-1 (]: Writing runtime sql for node "model.olist_dbt.stg_customers"
[0m21:57:36.062907 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */


  create view `intermediate`.`stg_order_items__dbt_tmp` 
  
    
    
  as (
    select
    order_id,
    order_item_id,
    product_id,
    seller_id,
    parseDateTimeBestEffortOrNull(shipping_limit_date) as shipping_limit_date,
    toFloat64OrNull(price) as price,
    toFloat64OrNull(freight_value) as freight_value,
    
    round(cast(toFloat64(price) as decimal(16, 2)), 2)
 as price_dollars
from `raw`.`olist_order_items_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:57:36.077732 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */


  create view `intermediate`.`stg_customers__dbt_tmp` 
  
    
    
  as (
    select
    customer_id,
    customer_unique_id,
    customer_zip_code_prefix,
    customer_city,
    customer_state
from `raw`.`olist_customers_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:57:36.090106 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:57:36.091780 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:36.108154 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    drop table if exists `intermediate`.`stg_order_items__dbt_backup` 
  
  ...
[0m21:57:36.116054 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    drop table if exists `intermediate`.`stg_customers__dbt_backup` 
  
  ...
[0m21:57:36.124286 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:57:36.127332 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    rename table `intermediate`.`stg_order_items` to `intermediate`.`stg_order_items__dbt_backup` 
  
  ...
[0m21:57:36.129172 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:36.133886 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:57:36.137289 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    rename table `intermediate`.`stg_customers` to `intermediate`.`stg_customers__dbt_backup` 
  
  ...
[0m21:57:36.146162 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    drop table if exists `intermediate`.`stg_order_items` 
  
  ...
[0m21:57:36.152496 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:36.162353 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:36.163160 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    drop table if exists `intermediate`.`stg_customers` 
  
  ...
[0m21:57:36.166453 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    rename table `intermediate`.`stg_order_items__dbt_tmp` to `intermediate`.`stg_order_items` 
  
  ...
[0m21:57:36.169026 [debug] [Thread-4 (]: Writing runtime sql for node "model.olist_dbt.stg_order_reviews"
[0m21:57:36.175013 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:57:36.176591 [debug] [Thread-3 (]: Writing runtime sql for node "model.olist_dbt.stg_order_payments"
[0m21:57:36.178173 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:36.180206 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    rename table `intermediate`.`stg_customers__dbt_tmp` to `intermediate`.`stg_customers` 
  
  ...
[0m21:57:36.221434 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */


  create view `intermediate`.`stg_order_payments__dbt_tmp` 
  
    
    
  as (
    select
    order_id,
    payment_sequential,
    payment_type,
    
    round(cast(toFloat64(payment_value) as decimal(16, 2)), 2)
 as payment_value_dollars
from `raw`.`olist_order_payments_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:57:36.234263 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */


  create view `intermediate`.`stg_order_reviews__dbt_tmp` 
  
    
    
  as (
    select
    review_id,
    order_id,
    toInt64OrNull(review_score) as review_score,
    review_comment_title,
    review_comment_message,
    parseDateTimeBestEffortOrNull(review_creation_date) as review_creation_date,
    parseDateTimeBestEffortOrNull(review_answer_timestamp) as review_answer_timestamp

from `raw`.`olist_order_reviews_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:57:36.235441 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m21:57:36.238858 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    drop table if exists `intermediate`.`stg_order_items__dbt_backup` 
  ...
[0m21:57:36.241228 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:36.248503 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    drop table if exists `intermediate`.`stg_customers__dbt_backup` 
  ...
[0m21:57:36.250838 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:36.259185 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    drop table if exists `intermediate`.`stg_order_payments__dbt_backup` 
  
  ...
[0m21:57:36.260343 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:36.338078 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m21:57:36.341547 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    drop table if exists `intermediate`.`stg_order_reviews__dbt_backup` 
  
  ...
[0m21:57:36.350111 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd898ee7c-a8e6-48fc-8444-a647466c8412', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9f1a5e7b0>]}
[0m21:57:36.352949 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd898ee7c-a8e6-48fc-8444-a647466c8412', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9f030b500>]}
[0m21:57:36.354124 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:36.357180 [info ] [Thread-2 (]: 2 of 11 OK created sql view model `intermediate`.`stg_order_items` ............. [[32mOK[0m in 0.56s]
[0m21:57:36.359259 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:57:36.360788 [info ] [Thread-1 (]: 1 of 11 OK created sql view model `intermediate`.`stg_customers` ............... [[32mOK[0m in 0.56s]
[0m21:57:36.364018 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    rename table `intermediate`.`stg_order_payments` to `intermediate`.`stg_order_payments__dbt_backup` 
  
  ...
[0m21:57:36.365867 [debug] [Thread-2 (]: Finished running node model.olist_dbt.stg_order_items
[0m21:57:36.368969 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    rename table `intermediate`.`stg_order_reviews` to `intermediate`.`stg_order_reviews__dbt_backup` 
  
  ...
[0m21:57:36.370804 [debug] [Thread-1 (]: Finished running node model.olist_dbt.stg_customers
[0m21:57:36.373452 [debug] [Thread-2 (]: Began running node model.olist_dbt.stg_orders
[0m21:57:36.375255 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:57:36.377639 [debug] [Thread-1 (]: Began running node model.olist_dbt.stg_product_category_name_translation
[0m21:57:36.379159 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:57:36.380046 [info ] [Thread-2 (]: 5 of 11 START sql view model `intermediate`.`stg_orders` ....................... [RUN]
[0m21:57:36.389197 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    drop table if exists `intermediate`.`stg_order_payments` 
  
  ...
[0m21:57:36.390938 [info ] [Thread-1 (]: 6 of 11 START sql view model `intermediate`.`stg_product_category_name_translation`  [RUN]
[0m21:57:36.399830 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    drop table if exists `intermediate`.`stg_order_reviews` 
  
  ...
[0m21:57:36.400817 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_order_items, now model.olist_dbt.stg_orders)
[0m21:57:36.403534 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_customers, now model.olist_dbt.stg_product_category_name_translation)
[0m21:57:36.404977 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:57:36.407012 [debug] [Thread-2 (]: Began compiling node model.olist_dbt.stg_orders
[0m21:57:36.408513 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:57:36.409156 [debug] [Thread-1 (]: Began compiling node model.olist_dbt.stg_product_category_name_translation
[0m21:57:36.412694 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    rename table `intermediate`.`stg_order_payments__dbt_tmp` to `intermediate`.`stg_order_payments` 
  
  ...
[0m21:57:36.418725 [debug] [Thread-2 (]: Writing injected SQL for node "model.olist_dbt.stg_orders"
[0m21:57:36.420826 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    rename table `intermediate`.`stg_order_reviews__dbt_tmp` to `intermediate`.`stg_order_reviews` 
  
  ...
[0m21:57:36.426133 [debug] [Thread-1 (]: Writing injected SQL for node "model.olist_dbt.stg_product_category_name_translation"
[0m21:57:36.431071 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:57:36.442425 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    drop table if exists `intermediate`.`stg_order_payments__dbt_backup` 
  ...
[0m21:57:36.444532 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:57:36.452245 [debug] [Thread-2 (]: Began executing node model.olist_dbt.stg_orders
[0m21:57:36.454781 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    drop table if exists `intermediate`.`stg_order_reviews__dbt_backup` 
  ...
[0m21:57:36.456120 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:36.462376 [debug] [Thread-1 (]: Began executing node model.olist_dbt.stg_product_category_name_translation
[0m21:57:36.466710 [debug] [Thread-2 (]: Writing runtime sql for node "model.olist_dbt.stg_orders"
[0m21:57:36.472628 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd898ee7c-a8e6-48fc-8444-a647466c8412', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ed28fc20>]}
[0m21:57:36.474541 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:36.481032 [debug] [Thread-1 (]: Creating new relation stg_product_category_name_translation
[0m21:57:36.483247 [info ] [Thread-3 (]: 3 of 11 OK created sql view model `intermediate`.`stg_order_payments` .......... [[32mOK[0m in 0.68s]
[0m21:57:36.488375 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd898ee7c-a8e6-48fc-8444-a647466c8412', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ec198260>]}
[0m21:57:36.491434 [debug] [Thread-1 (]: Writing runtime sql for node "model.olist_dbt.stg_product_category_name_translation"
[0m21:57:36.494146 [debug] [Thread-3 (]: Finished running node model.olist_dbt.stg_order_payments
[0m21:57:36.496533 [info ] [Thread-4 (]: 4 of 11 OK created sql view model `intermediate`.`stg_order_reviews` ........... [[32mOK[0m in 0.70s]
[0m21:57:36.498971 [debug] [Thread-3 (]: Began running node model.olist_dbt.stg_products
[0m21:57:36.500899 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */


  create view `intermediate`.`stg_orders__dbt_tmp` 
  
    
    
  as (
    select
    order_id,
    customer_id,
    order_status,
    parseDateTimeBestEffortOrNull(order_purchase_timestamp) as order_purchase_timestamp,
    parseDateTimeBestEffortOrNull(order_approved_at) as order_approved_at,
    parseDateTimeBestEffortOrNull(order_delivered_carrier_date) as order_delivered_carrier_date,
    parseDateTimeBestEffortOrNull(order_delivered_customer_date) as order_delivered_customer_date,
    parseDateTimeBestEffortOrNull(order_estimated_delivery_date) as order_estimated_delivery_date
from `raw`.`olist_orders_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:57:36.502798 [debug] [Thread-4 (]: Finished running node model.olist_dbt.stg_order_reviews
[0m21:57:36.504684 [info ] [Thread-3 (]: 7 of 11 START sql view model `intermediate`.`stg_products` ..................... [RUN]
[0m21:57:36.509506 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_order_payments, now model.olist_dbt.stg_products)
[0m21:57:36.511170 [debug] [Thread-3 (]: Began compiling node model.olist_dbt.stg_products
[0m21:57:36.519141 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_product_category_name_translation: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_product_category_name_translation"} */


  create view `intermediate`.`stg_product_category_name_translation` 
  
    
    
  as (
    select
    product_category_name,
    product_category_name_english

from `raw`.`product_category_name_translation`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:57:36.520238 [debug] [Thread-3 (]: Writing injected SQL for node "model.olist_dbt.stg_products"
[0m21:57:36.521487 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:57:36.531852 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    drop table if exists `intermediate`.`stg_orders__dbt_backup` 
  
  ...
[0m21:57:36.533724 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:36.543212 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd898ee7c-a8e6-48fc-8444-a647466c8412', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ee8e6270>]}
[0m21:57:36.550207 [info ] [Thread-1 (]: 6 of 11 OK created sql view model `intermediate`.`stg_product_category_name_translation`  [[32mOK[0m in 0.14s]
[0m21:57:36.556382 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:57:36.561379 [debug] [Thread-1 (]: Finished running node model.olist_dbt.stg_product_category_name_translation
[0m21:57:36.563617 [debug] [Thread-3 (]: Began executing node model.olist_dbt.stg_products
[0m21:57:36.572518 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    rename table `intermediate`.`stg_orders` to `intermediate`.`stg_orders__dbt_backup` 
  
  ...
[0m21:57:36.583942 [debug] [Thread-3 (]: Writing runtime sql for node "model.olist_dbt.stg_products"
[0m21:57:36.588443 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:57:36.597521 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    drop table if exists `intermediate`.`stg_orders` 
  
  ...
[0m21:57:36.602461 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:57:36.603510 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */


  create view `intermediate`.`stg_products__dbt_tmp` 
  
    
    
  as (
    select
    product_id,
    product_category_name,
    toInt64OrNull(product_name_lenght) as product_name_length,
    toInt64OrNull(product_description_lenght) as product_description_length,
    toInt64OrNull(product_photos_qty) as product_photos_qty,
    toFloat64OrNull(product_weight_g) as product_weight_g,
    toFloat64OrNull(product_length_cm) as product_length_cm,
    toFloat64OrNull(product_height_cm) as product_height_cm,
    toFloat64OrNull(product_width_cm) as product_width_cm

from `raw`.`olist_products_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m21:57:36.605615 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    rename table `intermediate`.`stg_orders__dbt_tmp` to `intermediate`.`stg_orders` 
  
  ...
[0m21:57:36.611009 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:57:36.618956 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    drop table if exists `intermediate`.`stg_orders__dbt_backup` 
  ...
[0m21:57:36.620448 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:36.629035 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */

    drop table if exists `intermediate`.`stg_products__dbt_backup` 
  
  ...
[0m21:57:36.631863 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:36.636182 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd898ee7c-a8e6-48fc-8444-a647466c8412', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ed3c8b30>]}
[0m21:57:36.638319 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:36.640026 [info ] [Thread-2 (]: 5 of 11 OK created sql view model `intermediate`.`stg_orders` .................. [[32mOK[0m in 0.24s]
[0m21:57:36.653842 [debug] [Thread-2 (]: Finished running node model.olist_dbt.stg_orders
[0m21:57:36.660361 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */

    rename table `intermediate`.`stg_products` to `intermediate`.`stg_products__dbt_backup` 
  
  ...
[0m21:57:36.663706 [debug] [Thread-4 (]: Began running node model.olist_dbt.fct_orders
[0m21:57:36.665643 [info ] [Thread-4 (]: 8 of 11 START sql incremental model `reporting`.`fct_orders` ................... [RUN]
[0m21:57:36.668144 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:36.669587 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_order_reviews, now model.olist_dbt.fct_orders)
[0m21:57:36.682087 [debug] [Thread-4 (]: Began compiling node model.olist_dbt.fct_orders
[0m21:57:36.693971 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */

    drop table if exists `intermediate`.`stg_products` 
  
  ...
[0m21:57:36.714784 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:36.715467 [debug] [Thread-4 (]: Writing injected SQL for node "model.olist_dbt.fct_orders"
[0m21:57:36.717438 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */

    rename table `intermediate`.`stg_products__dbt_tmp` to `intermediate`.`stg_products` 
  
  ...
[0m21:57:36.722500 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:57:36.733292 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */

    drop table if exists `intermediate`.`stg_products__dbt_backup` 
  ...
[0m21:57:36.737697 [debug] [Thread-4 (]: Began executing node model.olist_dbt.fct_orders
[0m21:57:36.738730 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:57:36.753346 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd898ee7c-a8e6-48fc-8444-a647466c8412', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ef8a6ba0>]}
[0m21:57:36.760510 [info ] [Thread-3 (]: 7 of 11 OK created sql view model `intermediate`.`stg_products` ................ [[32mOK[0m in 0.24s]
[0m21:57:36.773020 [debug] [Thread-3 (]: Finished running node model.olist_dbt.stg_products
[0m21:57:36.799435 [debug] [Thread-2 (]: Began running node model.olist_dbt.mart_product_performance
[0m21:57:36.806618 [info ] [Thread-2 (]: 9 of 11 START sql table model `reporting`.`mart_product_performance` ........... [RUN]
[0m21:57:36.819493 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_orders, now model.olist_dbt.mart_product_performance)
[0m21:57:36.826442 [debug] [Thread-2 (]: Began compiling node model.olist_dbt.mart_product_performance
[0m21:57:36.855736 [debug] [Thread-2 (]: Writing injected SQL for node "model.olist_dbt.mart_product_performance"
[0m21:57:36.876084 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.fct_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.fct_orders"} */

    select name, type from system.columns where table = 'fct_orders'
    
      and database = 'reporting'
    
    order by position
  ...
[0m21:57:36.880472 [debug] [Thread-2 (]: Began executing node model.olist_dbt.mart_product_performance
[0m21:57:36.893443 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:57:36.922153 [debug] [Thread-4 (]: Writing runtime sql for node "model.olist_dbt.fct_orders"
[0m21:57:36.974201 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.fct_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.fct_orders"} */

        insert into `reporting`.`fct_orders`
        ("order_id", "customer_id", "order_status", "order_purchase_timestamp", "order_approved_at", "order_delivered_customer_date", "total_amount")-- sql


with order_payments as (
    select
        order_id,
        sum(toFloat64(payment_value_dollars)) as total_amount
    from `intermediate`.`stg_order_payments`
    group by 1
)

select
    o.order_id,
    o.customer_id,
    o.order_status,

    -- Always non-NULL DateTime for adapter's CAST('timestamp')
    ifNull(
      parseDateTimeBestEffortOrNull(nullIf(toString(o.order_purchase_timestamp), '')),
      toDateTime('1970-01-01 00:00:00')
    ) as order_purchase_timestamp,

    ifNull(
      parseDateTimeBestEffortOrNull(nullIf(toString(o.order_approved_at), '')),
      toDateTime('1970-01-01 00:00:00')
    ) as order_approved_at,

    ifNull(
      parseDateTimeBestEffortOrNull(nullIf(toString(o.order_delivered_customer_date), '')),
      toDateTime('1970-01-01 00:00:00')
    ) as order_delivered_customer_date,

    ifNull(op.total_amount, 0.0) as total_amount
from `intermediate`.`stg_orders` o
left join order_payments op on o.order_id = op.order_id


  where order_purchase_timestamp > (select max(order_purchase_timestamp) from `reporting`.`fct_orders`)

    ...
[0m21:57:37.024928 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_product_performance: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_product_performance"} */

            

    
        create table `reporting`.`mart_product_performance__dbt_backup`
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            with order_items as (
     select
         order_id,
         product_id,
         price,
         freight_value
     from `intermediate`.`stg_order_items`
// Hidden Lines
 order_reviews as (
     select
         order_id,
         avg(review_score) as avg_review_score
     from `intermediate`.`stg_order_reviews`
     group by 1
 ),

 translations as (
     select * from `intermediate`.`stg_product_category_name_translation`
 )

 -- Aggregate metrics from order items
// Hidden Lines

 -- Aggregate review scores, joining through order_items to link reviews to products
 product_reviews as (
     select
         product_id,
         avg(avg_review_score) as average_review_score
     from order_items
     left join order_reviews using(order_id)
     group by product_id
 )

 select
     p.product_id as product_id,
     t.product_category_name_english as product_category,
     coalesce(pm.total_units_sold, 0) as total_units_sold,
     coalesce(pm.total_revenue, 0) as total_revenue,
     coalesce(pr.average_review_score, 0) as average_review_score
 from `intermediate`.`stg_products` p
 left join product_metrics pm on p.product_id = pm.product_id
 left join product_reviews pr on p.product_id = pr.product_id
 left join translations t on p.product_category_name = t.product_category_name
 where pm.total_orders is not null -- Only include products that have been sold
 order by total_revenue desc
          )
        ...
[0m21:57:37.031638 [debug] [Thread-2 (]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_product_performance"} */

            

    
        create table `reporting`.`mart_product_performance__dbt_backup`
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            with order_items as (
     select
         order_id,
         product_id,
         price,
         freight_value
     from `intermediate`.`stg_order_items`
// Hidden Lines
 order_reviews as (
     select
         order_id,
         avg(review_score) as avg_review_score
     from `intermediate`.`stg_order_reviews`
     group by 1
 ),

 translations as (
     select * from `intermediate`.`stg_product_category_name_translation`
 )

 -- Aggregate metrics from order items
// Hidden Lines

 -- Aggregate review scores, joining through order_items to link reviews to products
 product_reviews as (
     select
         product_id,
         avg(avg_review_score) as average_review_score
     from order_items
     left join order_reviews using(order_id)
     group by product_id
 )

 select
     p.product_id as product_id,
     t.product_category_name_english as product_category,
     coalesce(pm.total_units_sold, 0) as total_units_sold,
     coalesce(pm.total_revenue, 0) as total_revenue,
     coalesce(pr.average_review_score, 0) as average_review_score
 from `intermediate`.`stg_products` p
 left join product_metrics pm on p.product_id = pm.product_id
 left join product_reviews pr on p.product_id = pr.product_id
 left join translations t on p.product_category_name = t.product_category_name
 where pm.total_orders is not null -- Only include products that have been sold
 order by total_revenue desc
          )
        
[0m21:57:37.048085 [debug] [Thread-2 (]: Database Error in model mart_product_performance (models/marts/mart_product_performance.sql)
  HTTPDriver for http://clickhouse-server:8123 received ClickHouse error code 62
   Code: 62. DB::Exception: Syntax error: failed at position 509 ('(') (line 22, col 14): (
              with order_items as (
       select
           order_id,
           product_id,
           price,
           freight_value
       from `intermediate`.`stg_ord. Unmatched parentheses: (. (SYNTAX_ERROR) (version 23.8.16.16 (official build))
[0m21:57:37.049819 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd898ee7c-a8e6-48fc-8444-a647466c8412', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ef434a70>]}
[0m21:57:37.052005 [error] [Thread-2 (]: 9 of 11 ERROR creating sql table model `reporting`.`mart_product_performance` .. [[31mERROR[0m in 0.23s]
[0m21:57:37.054823 [debug] [Thread-2 (]: Finished running node model.olist_dbt.mart_product_performance
[0m21:57:37.150806 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.17 seconds
[0m21:57:37.156889 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd898ee7c-a8e6-48fc-8444-a647466c8412', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ef443680>]}
[0m21:57:37.159287 [info ] [Thread-4 (]: 8 of 11 OK created sql incremental model `reporting`.`fct_orders` .............. [[32mOK[0m in 0.49s]
[0m21:57:37.163864 [debug] [Thread-4 (]: Finished running node model.olist_dbt.fct_orders
[0m21:57:37.167823 [debug] [Thread-3 (]: Began running node model.olist_dbt.mart_customer_revenue
[0m21:57:37.169257 [debug] [Thread-1 (]: Began running node model.olist_dbt.mart_monthly_category_revenue
[0m21:57:37.170872 [info ] [Thread-3 (]: 10 of 11 START sql table model `reporting`.`mart_customer_revenue` ............. [RUN]
[0m21:57:37.172970 [info ] [Thread-1 (]: 11 of 11 START sql table model `reporting`.`mart_monthly_category_revenue` ..... [RUN]
[0m21:57:37.174653 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_products, now model.olist_dbt.mart_customer_revenue)
[0m21:57:37.176657 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_product_category_name_translation, now model.olist_dbt.mart_monthly_category_revenue)
[0m21:57:37.178411 [debug] [Thread-3 (]: Began compiling node model.olist_dbt.mart_customer_revenue
[0m21:57:37.180314 [debug] [Thread-1 (]: Began compiling node model.olist_dbt.mart_monthly_category_revenue
[0m21:57:37.190627 [debug] [Thread-3 (]: Writing injected SQL for node "model.olist_dbt.mart_customer_revenue"
[0m21:57:37.199545 [debug] [Thread-1 (]: Writing injected SQL for node "model.olist_dbt.mart_monthly_category_revenue"
[0m21:57:37.206861 [debug] [Thread-3 (]: Began executing node model.olist_dbt.mart_customer_revenue
[0m21:57:37.214373 [debug] [Thread-1 (]: Began executing node model.olist_dbt.mart_monthly_category_revenue
[0m21:57:37.215530 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

            

    
        create table `reporting`.`mart_customer_revenue__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (customer_unique_id)
        
        
        
        
                    -- end_of_sql
                    SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

                    
            empty
          as (
            

select
    assumeNotNull(c.customer_unique_id) as customer_unique_id ,
    c.customer_state,
    min(o.order_purchase_timestamp) as first_order_date,
    max(o.order_purchase_timestamp) as last_order_date,
    count(o.order_id) as number_of_orders,
    sum(o.total_amount) as total_revenue
from `reporting`.`fct_orders` o
join `intermediate`.`stg_customers` c on o.customer_id = c.customer_id
group by 1, 2
order by total_revenue desc
          )
        ...
[0m21:57:37.220005 [debug] [Thread-1 (]: Creating new relation mart_monthly_category_revenue
[0m21:57:37.223648 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_monthly_category_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_monthly_category_revenue"} */

            

    
        create table `reporting`.`mart_monthly_category_revenue`
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            with orders as (
    select order_id, order_purchase_timestamp from `reporting`.`fct_orders`
),

order_items as (
    select order_id, product_id, price from `intermediate`.`stg_order_items`
),

products as (
    select product_id, product_category_name from `intermediate`.`stg_products`
),

translations as (
    select * from `intermediate`.`stg_product_category_name_translation`
)

select
    toStartOfMonth(o.order_purchase_timestamp) as order_month,
    t.product_category_name_english as product_category,
    sum(oi.price) as total_revenue
from orders o
join order_items oi on o.order_id = oi.order_id
join products p on oi.product_id = p.product_id
left join translations t on p.product_category_name = t.product_category_name
where o.order_purchase_timestamp is not null and t.product_category_name_english is not null
group by 1, 2
order by 1, 3 desc
          )
        ...
[0m21:57:37.237679 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m21:57:37.252190 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

    select name, type from system.columns where table = 'mart_customer_revenue__dbt_backup'
    
      and database = 'reporting'
    
    order by position
  ...
[0m21:57:37.264510 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:37.266898 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m21:57:37.272145 [debug] [Thread-3 (]: Writing runtime sql for node "model.olist_dbt.mart_customer_revenue"
[0m21:57:37.282071 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_monthly_category_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_monthly_category_revenue"} */

    select name, type from system.columns where table = 'mart_monthly_category_revenue'
    
      and database = 'reporting'
    
    order by position
  ...
[0m21:57:37.293378 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m21:57:37.295122 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

  
    
    
    
        
        insert into `reporting`.`mart_customer_revenue__dbt_backup`
        ("customer_unique_id", "customer_state", "first_order_date", "last_order_date", "number_of_orders", "total_revenue")

select
    assumeNotNull(c.customer_unique_id) as customer_unique_id ,
    c.customer_state,
    min(o.order_purchase_timestamp) as first_order_date,
    max(o.order_purchase_timestamp) as last_order_date,
    count(o.order_id) as number_of_orders,
    sum(o.total_amount) as total_revenue
from `reporting`.`fct_orders` o
join `intermediate`.`stg_customers` c on o.customer_id = c.customer_id
group by 1, 2
order by total_revenue desc
  ...
[0m21:57:37.299239 [debug] [Thread-1 (]: Writing runtime sql for node "model.olist_dbt.mart_monthly_category_revenue"
[0m21:57:37.313954 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_monthly_category_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_monthly_category_revenue"} */

  
    
    
    
        
        insert into `reporting`.`mart_monthly_category_revenue`
        ("order_month", "product_category", "total_revenue")with orders as (
    select order_id, order_purchase_timestamp from `reporting`.`fct_orders`
),

order_items as (
    select order_id, product_id, price from `intermediate`.`stg_order_items`
),

products as (
    select product_id, product_category_name from `intermediate`.`stg_products`
),

translations as (
    select * from `intermediate`.`stg_product_category_name_translation`
)

select
    toStartOfMonth(o.order_purchase_timestamp) as order_month,
    t.product_category_name_english as product_category,
    sum(oi.price) as total_revenue
from orders o
join order_items oi on o.order_id = oi.order_id
join products p on oi.product_id = p.product_id
left join translations t on p.product_category_name = t.product_category_name
where o.order_purchase_timestamp is not null and t.product_category_name_english is not null
group by 1, 2
order by 1, 3 desc
  ...
[0m21:57:37.668856 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.35 seconds
[0m21:57:37.674199 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd898ee7c-a8e6-48fc-8444-a647466c8412', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ef3fb500>]}
[0m21:57:37.676609 [info ] [Thread-1 (]: 11 of 11 OK created sql table model `reporting`.`mart_monthly_category_revenue`  [[32mOK[0m in 0.50s]
[0m21:57:37.683589 [debug] [Thread-1 (]: Finished running node model.olist_dbt.mart_monthly_category_revenue
[0m21:57:37.835013 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.53 seconds
[0m21:57:37.845971 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */
EXCHANGE TABLES `reporting`.`mart_customer_revenue__dbt_backup` AND `reporting`.`mart_customer_revenue` 
  
  ...
[0m21:57:37.849956 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:57:37.856573 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

    drop table if exists `reporting`.`mart_customer_revenue__dbt_backup` 
  ...
[0m21:57:37.860318 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m21:57:37.863072 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd898ee7c-a8e6-48fc-8444-a647466c8412', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ed4158b0>]}
[0m21:57:37.864287 [info ] [Thread-3 (]: 10 of 11 OK created sql table model `reporting`.`mart_customer_revenue` ........ [[32mOK[0m in 0.69s]
[0m21:57:37.866378 [debug] [Thread-3 (]: Finished running node model.olist_dbt.mart_customer_revenue
[0m21:57:37.870359 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:57:37.871305 [debug] [MainThread]: Connection 'model.olist_dbt.mart_monthly_category_revenue' was left open.
[0m21:57:37.872159 [debug] [MainThread]: On model.olist_dbt.mart_monthly_category_revenue: Close
[0m21:57:37.872921 [debug] [MainThread]: Connection 'model.olist_dbt.mart_product_performance' was left open.
[0m21:57:37.873576 [debug] [MainThread]: On model.olist_dbt.mart_product_performance: Close
[0m21:57:37.874299 [debug] [MainThread]: Connection 'model.olist_dbt.mart_customer_revenue' was left open.
[0m21:57:37.875174 [debug] [MainThread]: On model.olist_dbt.mart_customer_revenue: Close
[0m21:57:37.876060 [debug] [MainThread]: Connection 'model.olist_dbt.fct_orders' was left open.
[0m21:57:37.876906 [debug] [MainThread]: On model.olist_dbt.fct_orders: Close
[0m21:57:37.878024 [info ] [MainThread]: 
[0m21:57:37.879030 [info ] [MainThread]: Finished running 7 view models, 3 table models, 1 incremental model in 0 hours 0 minutes and 2.51 seconds (2.51s).
[0m21:57:37.884618 [debug] [MainThread]: Command end result
[0m21:57:37.979509 [info ] [MainThread]: 
[0m21:57:37.980565 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:57:37.982107 [info ] [MainThread]: 
[0m21:57:37.983724 [error] [MainThread]:   Database Error in model mart_product_performance (models/marts/mart_product_performance.sql)
  HTTPDriver for http://clickhouse-server:8123 received ClickHouse error code 62
   Code: 62. DB::Exception: Syntax error: failed at position 509 ('(') (line 22, col 14): (
              with order_items as (
       select
           order_id,
           product_id,
           price,
           freight_value
       from `intermediate`.`stg_ord. Unmatched parentheses: (. (SYNTAX_ERROR) (version 23.8.16.16 (official build))
[0m21:57:37.985523 [info ] [MainThread]: 
[0m21:57:37.988539 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=1 SKIP=0 TOTAL=11
[0m21:57:37.991213 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 5.3274803, "process_in_blocks": "0", "process_kernel_time": 0.499661, "process_mem_max_rss": "124204", "process_out_blocks": "2976", "process_user_time": 7.604844}
[0m21:57:37.993501 [debug] [MainThread]: Command `dbt run` failed at 21:57:37.993053 after 5.33 seconds
[0m21:57:37.994854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9f404e9c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9ef43e7e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd9f0c936b0>]}
[0m21:57:37.996383 [debug] [MainThread]: Flushing usage events
[0m22:04:36.301412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff835321850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff832b70b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8329335c0>]}


============================== 22:04:36.313168 | c0bce8a2-b083-4eab-b60e-ff33bb1eb04e ==============================
[0m22:04:36.313168 [info ] [MainThread]: Running with dbt=1.8.9
[0m22:04:36.314805 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/usr/app/dbt/dbt_project/logs', 'profiles_dir': '.', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir .', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:04:36.717006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c0bce8a2-b083-4eab-b60e-ff33bb1eb04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8325fb830>]}
[0m22:04:36.839979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c0bce8a2-b083-4eab-b60e-ff33bb1eb04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8344de270>]}
[0m22:04:36.841541 [info ] [MainThread]: Registered adapter: clickhouse=1.8.0
[0m22:04:37.037279 [debug] [MainThread]: checksum: 132857a23e9d07220246854f7763165174ce9b737cfc7867629ace4294e520b1, vars: {}, profile: , target: , version: 1.8.9
[0m22:04:37.518219 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:04:37.519832 [debug] [MainThread]: Partial parsing: updated file: olist_dbt://models/marts/mart_product_performance.sql
[0m22:04:38.200225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c0bce8a2-b083-4eab-b60e-ff33bb1eb04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff831eeb560>]}
[0m22:04:38.464488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c0bce8a2-b083-4eab-b60e-ff33bb1eb04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff831ef4bc0>]}
[0m22:04:38.465506 [info ] [MainThread]: Found 11 models, 7 sources, 464 macros
[0m22:04:38.466398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c0bce8a2-b083-4eab-b60e-ff33bb1eb04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8324e1df0>]}
[0m22:04:38.471135 [info ] [MainThread]: 
[0m22:04:38.473395 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m22:04:38.497212 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m22:04:38.503894 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m22:04:38.549661 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:04:38.550654 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:04:38.740153 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m22:04:38.741081 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m22:04:38.745570 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:38.747085 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:38.774327 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__reporting)
[0m22:04:38.781202 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__intermediate)
[0m22:04:38.790136 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__intermediate: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list__intermediate"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'intermediate'
      

  ...
[0m22:04:38.790989 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__reporting: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "connection_name": "list__reporting"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'reporting'
      

  ...
[0m22:04:38.797027 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:38.800374 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:38.806028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c0bce8a2-b083-4eab-b60e-ff33bb1eb04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff83444d8b0>]}
[0m22:04:38.807180 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:04:38.807990 [info ] [MainThread]: 
[0m22:04:38.823093 [debug] [Thread-1 (]: Began running node model.olist_dbt.stg_customers
[0m22:04:38.824310 [debug] [Thread-2 (]: Began running node model.olist_dbt.stg_order_items
[0m22:04:38.825421 [debug] [Thread-3 (]: Began running node model.olist_dbt.stg_order_payments
[0m22:04:38.827806 [debug] [Thread-4 (]: Began running node model.olist_dbt.stg_order_reviews
[0m22:04:38.826723 [info ] [Thread-1 (]: 1 of 11 START sql view model `intermediate`.`stg_customers` .................... [RUN]
[0m22:04:38.829875 [info ] [Thread-2 (]: 2 of 11 START sql view model `intermediate`.`stg_order_items` .................. [RUN]
[0m22:04:38.831661 [info ] [Thread-3 (]: 3 of 11 START sql view model `intermediate`.`stg_order_payments` ............... [RUN]
[0m22:04:38.833544 [info ] [Thread-4 (]: 4 of 11 START sql view model `intermediate`.`stg_order_reviews` ................ [RUN]
[0m22:04:38.835129 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list__reporting, now model.olist_dbt.stg_customers)
[0m22:04:38.836736 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list__intermediate, now model.olist_dbt.stg_order_items)
[0m22:04:38.838497 [debug] [Thread-3 (]: Acquiring new clickhouse connection 'model.olist_dbt.stg_order_payments'
[0m22:04:38.839827 [debug] [Thread-4 (]: Acquiring new clickhouse connection 'model.olist_dbt.stg_order_reviews'
[0m22:04:38.841226 [debug] [Thread-1 (]: Began compiling node model.olist_dbt.stg_customers
[0m22:04:38.842663 [debug] [Thread-2 (]: Began compiling node model.olist_dbt.stg_order_items
[0m22:04:38.844025 [debug] [Thread-3 (]: Began compiling node model.olist_dbt.stg_order_payments
[0m22:04:38.845025 [debug] [Thread-4 (]: Began compiling node model.olist_dbt.stg_order_reviews
[0m22:04:38.863843 [debug] [Thread-1 (]: Writing injected SQL for node "model.olist_dbt.stg_customers"
[0m22:04:38.875488 [debug] [Thread-3 (]: Writing injected SQL for node "model.olist_dbt.stg_order_payments"
[0m22:04:38.869283 [debug] [Thread-2 (]: Writing injected SQL for node "model.olist_dbt.stg_order_items"
[0m22:04:38.880794 [debug] [Thread-4 (]: Writing injected SQL for node "model.olist_dbt.stg_order_reviews"
[0m22:04:38.889991 [debug] [Thread-3 (]: Began executing node model.olist_dbt.stg_order_payments
[0m22:04:38.891092 [debug] [Thread-1 (]: Began executing node model.olist_dbt.stg_customers
[0m22:04:38.923952 [debug] [Thread-4 (]: Began executing node model.olist_dbt.stg_order_reviews
[0m22:04:39.004922 [debug] [Thread-2 (]: Began executing node model.olist_dbt.stg_order_items
[0m22:04:39.052075 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:04:39.055689 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:04:39.058233 [debug] [Thread-1 (]: Writing runtime sql for node "model.olist_dbt.stg_customers"
[0m22:04:39.061282 [debug] [Thread-2 (]: Writing runtime sql for node "model.olist_dbt.stg_order_items"
[0m22:04:39.094684 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */


  create view `intermediate`.`stg_order_items__dbt_tmp` 
  
    
    
  as (
    select
    order_id,
    order_item_id,
    product_id,
    seller_id,
    parseDateTimeBestEffortOrNull(shipping_limit_date) as shipping_limit_date,
    toFloat64OrNull(price) as price,
    toFloat64OrNull(freight_value) as freight_value,
    
    round(cast(toFloat64(price) as decimal(16, 2)), 2)
 as price_dollars
from `raw`.`olist_order_items_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:04:39.096022 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */


  create view `intermediate`.`stg_customers__dbt_tmp` 
  
    
    
  as (
    select
    customer_id,
    customer_unique_id,
    customer_zip_code_prefix,
    customer_city,
    customer_state
from `raw`.`olist_customers_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:04:39.108700 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.111016 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.129254 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    drop table if exists `intermediate`.`stg_order_items__dbt_backup` 
  
  ...
[0m22:04:39.138845 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    drop table if exists `intermediate`.`stg_customers__dbt_backup` 
  
  ...
[0m22:04:39.145587 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:39.148672 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    rename table `intermediate`.`stg_order_items` to `intermediate`.`stg_order_items__dbt_backup` 
  
  ...
[0m22:04:39.150660 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.156042 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    rename table `intermediate`.`stg_customers` to `intermediate`.`stg_customers__dbt_backup` 
  
  ...
[0m22:04:39.161004 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.162597 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:39.170303 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    drop table if exists `intermediate`.`stg_order_items` 
  
  ...
[0m22:04:39.179787 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    drop table if exists `intermediate`.`stg_customers` 
  
  ...
[0m22:04:39.186585 [debug] [Thread-4 (]: Writing runtime sql for node "model.olist_dbt.stg_order_reviews"
[0m22:04:39.187844 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.189785 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:39.194288 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    rename table `intermediate`.`stg_order_items__dbt_tmp` to `intermediate`.`stg_order_items` 
  
  ...
[0m22:04:39.197646 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    rename table `intermediate`.`stg_customers__dbt_tmp` to `intermediate`.`stg_customers` 
  
  ...
[0m22:04:39.199255 [debug] [Thread-3 (]: Writing runtime sql for node "model.olist_dbt.stg_order_payments"
[0m22:04:39.203723 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:39.205867 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:39.207024 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */


  create view `intermediate`.`stg_order_reviews__dbt_tmp` 
  
    
    
  as (
    select
    review_id,
    order_id,
    toInt64OrNull(review_score) as review_score,
    review_comment_title,
    review_comment_message,
    parseDateTimeBestEffortOrNull(review_creation_date) as review_creation_date,
    parseDateTimeBestEffortOrNull(review_answer_timestamp) as review_answer_timestamp

from `raw`.`olist_order_reviews_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:04:39.263150 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:04:39.280563 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    drop table if exists `intermediate`.`stg_order_reviews__dbt_backup` 
  
  ...
[0m22:04:39.293439 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */


  create view `intermediate`.`stg_order_payments__dbt_tmp` 
  
    
    
  as (
    select
    order_id,
    payment_sequential,
    payment_type,
    
    round(cast(toFloat64(payment_value) as decimal(16, 2)), 2)
 as payment_value_dollars
from `raw`.`olist_order_payments_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:04:39.308416 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_customers: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_customers"} */

    drop table if exists `intermediate`.`stg_customers__dbt_backup` 
  ...
[0m22:04:39.311737 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_items: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_items"} */

    drop table if exists `intermediate`.`stg_order_items__dbt_backup` 
  ...
[0m22:04:39.314669 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m22:04:39.318240 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.320494 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    rename table `intermediate`.`stg_order_reviews` to `intermediate`.`stg_order_reviews__dbt_backup` 
  
  ...
[0m22:04:39.322436 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.328553 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c0bce8a2-b083-4eab-b60e-ff33bb1eb04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8311ba690>]}
[0m22:04:39.329839 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m22:04:39.334103 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c0bce8a2-b083-4eab-b60e-ff33bb1eb04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff813b175f0>]}
[0m22:04:39.335366 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:39.336547 [info ] [Thread-1 (]: 1 of 11 OK created sql view model `intermediate`.`stg_customers` ............... [[32mOK[0m in 0.49s]
[0m22:04:39.344046 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    drop table if exists `intermediate`.`stg_order_payments__dbt_backup` 
  
  ...
[0m22:04:39.345279 [info ] [Thread-2 (]: 2 of 11 OK created sql view model `intermediate`.`stg_order_items` ............. [[32mOK[0m in 0.50s]
[0m22:04:39.352844 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    drop table if exists `intermediate`.`stg_order_reviews` 
  
  ...
[0m22:04:39.354249 [debug] [Thread-1 (]: Finished running node model.olist_dbt.stg_customers
[0m22:04:39.357724 [debug] [Thread-2 (]: Finished running node model.olist_dbt.stg_order_items
[0m22:04:39.359312 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:39.362195 [debug] [Thread-1 (]: Began running node model.olist_dbt.stg_orders
[0m22:04:39.363740 [debug] [Thread-2 (]: Began running node model.olist_dbt.stg_product_category_name_translation
[0m22:04:39.364789 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:39.367441 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    rename table `intermediate`.`stg_order_payments` to `intermediate`.`stg_order_payments__dbt_backup` 
  
  ...
[0m22:04:39.368981 [info ] [Thread-1 (]: 5 of 11 START sql view model `intermediate`.`stg_orders` ....................... [RUN]
[0m22:04:39.370621 [info ] [Thread-2 (]: 6 of 11 START sql view model `intermediate`.`stg_product_category_name_translation`  [RUN]
[0m22:04:39.374253 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    rename table `intermediate`.`stg_order_reviews__dbt_tmp` to `intermediate`.`stg_order_reviews` 
  
  ...
[0m22:04:39.377955 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_customers, now model.olist_dbt.stg_orders)
[0m22:04:39.379846 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:39.380999 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_order_items, now model.olist_dbt.stg_product_category_name_translation)
[0m22:04:39.384792 [debug] [Thread-1 (]: Began compiling node model.olist_dbt.stg_orders
[0m22:04:39.387866 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.421497 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    drop table if exists `intermediate`.`stg_order_payments` 
  
  ...
[0m22:04:39.422283 [debug] [Thread-2 (]: Began compiling node model.olist_dbt.stg_product_category_name_translation
[0m22:04:39.428370 [debug] [Thread-1 (]: Writing injected SQL for node "model.olist_dbt.stg_orders"
[0m22:04:39.435810 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_reviews: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_reviews"} */

    drop table if exists `intermediate`.`stg_order_reviews__dbt_backup` 
  ...
[0m22:04:39.443528 [debug] [Thread-2 (]: Writing injected SQL for node "model.olist_dbt.stg_product_category_name_translation"
[0m22:04:39.445129 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.450825 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    rename table `intermediate`.`stg_order_payments__dbt_tmp` to `intermediate`.`stg_order_payments` 
  
  ...
[0m22:04:39.452941 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.457726 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c0bce8a2-b083-4eab-b60e-ff33bb1eb04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff813a9c6e0>]}
[0m22:04:39.461546 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.462859 [debug] [Thread-1 (]: Began executing node model.olist_dbt.stg_orders
[0m22:04:39.460058 [info ] [Thread-4 (]: 4 of 11 OK created sql view model `intermediate`.`stg_order_reviews` ........... [[32mOK[0m in 0.62s]
[0m22:04:39.469744 [debug] [Thread-2 (]: Began executing node model.olist_dbt.stg_product_category_name_translation
[0m22:04:39.474392 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_order_payments: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_order_payments"} */

    drop table if exists `intermediate`.`stg_order_payments__dbt_backup` 
  ...
[0m22:04:39.481573 [debug] [Thread-1 (]: Writing runtime sql for node "model.olist_dbt.stg_orders"
[0m22:04:39.482975 [debug] [Thread-4 (]: Finished running node model.olist_dbt.stg_order_reviews
[0m22:04:39.489174 [debug] [Thread-2 (]: Writing runtime sql for node "model.olist_dbt.stg_product_category_name_translation"
[0m22:04:39.492430 [debug] [Thread-4 (]: Began running node model.olist_dbt.stg_products
[0m22:04:39.494895 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:39.497202 [info ] [Thread-4 (]: 7 of 11 START sql view model `intermediate`.`stg_products` ..................... [RUN]
[0m22:04:39.502642 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c0bce8a2-b083-4eab-b60e-ff33bb1eb04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff813bb1130>]}
[0m22:04:39.504670 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_order_reviews, now model.olist_dbt.stg_products)
[0m22:04:39.507551 [info ] [Thread-3 (]: 3 of 11 OK created sql view model `intermediate`.`stg_order_payments` .......... [[32mOK[0m in 0.66s]
[0m22:04:39.517711 [debug] [Thread-4 (]: Began compiling node model.olist_dbt.stg_products
[0m22:04:39.509062 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */


  create view `intermediate`.`stg_orders__dbt_tmp` 
  
    
    
  as (
    select
    order_id,
    customer_id,
    order_status,
    parseDateTimeBestEffortOrNull(order_purchase_timestamp) as order_purchase_timestamp,
    parseDateTimeBestEffortOrNull(order_approved_at) as order_approved_at,
    parseDateTimeBestEffortOrNull(order_delivered_carrier_date) as order_delivered_carrier_date,
    parseDateTimeBestEffortOrNull(order_delivered_customer_date) as order_delivered_customer_date,
    parseDateTimeBestEffortOrNull(order_estimated_delivery_date) as order_estimated_delivery_date
from `raw`.`olist_orders_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:04:39.520430 [debug] [Thread-3 (]: Finished running node model.olist_dbt.stg_order_payments
[0m22:04:39.522194 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_product_category_name_translation: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_product_category_name_translation"} */


  create view `intermediate`.`stg_product_category_name_translation__dbt_tmp` 
  
    
    
  as (
    select
    product_category_name,
    product_category_name_english

from `raw`.`product_category_name_translation`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:04:39.539566 [debug] [Thread-4 (]: Writing injected SQL for node "model.olist_dbt.stg_products"
[0m22:04:39.549295 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.551048 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:04:39.570197 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_product_category_name_translation: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_product_category_name_translation"} */

    drop table if exists `intermediate`.`stg_product_category_name_translation__dbt_backup` 
  
  ...
[0m22:04:39.573811 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    drop table if exists `intermediate`.`stg_orders__dbt_backup` 
  
  ...
[0m22:04:39.578793 [debug] [Thread-4 (]: Began executing node model.olist_dbt.stg_products
[0m22:04:39.580565 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.589457 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.591155 [debug] [Thread-4 (]: Writing runtime sql for node "model.olist_dbt.stg_products"
[0m22:04:39.593409 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_product_category_name_translation: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_product_category_name_translation"} */

    rename table `intermediate`.`stg_product_category_name_translation` to `intermediate`.`stg_product_category_name_translation__dbt_backup` 
  
  ...
[0m22:04:39.595769 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    rename table `intermediate`.`stg_orders` to `intermediate`.`stg_orders__dbt_backup` 
  
  ...
[0m22:04:39.600699 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:39.602388 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:39.710651 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_product_category_name_translation: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_product_category_name_translation"} */

    drop table if exists `intermediate`.`stg_product_category_name_translation` 
  
  ...
[0m22:04:39.712667 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    drop table if exists `intermediate`.`stg_orders` 
  
  ...
[0m22:04:39.716278 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */


  create view `intermediate`.`stg_products__dbt_tmp` 
  
    
    
  as (
    select
    product_id,
    product_category_name,
    toInt64OrNull(product_name_lenght) as product_name_length,
    toInt64OrNull(product_description_lenght) as product_description_length,
    toInt64OrNull(product_photos_qty) as product_photos_qty,
    toFloat64OrNull(product_weight_g) as product_weight_g,
    toFloat64OrNull(product_length_cm) as product_length_cm,
    toFloat64OrNull(product_height_cm) as product_height_cm,
    toFloat64OrNull(product_width_cm) as product_width_cm

from `raw`.`olist_products_dataset`
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m22:04:39.718064 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:39.720274 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.722963 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_product_category_name_translation: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_product_category_name_translation"} */

    rename table `intermediate`.`stg_product_category_name_translation__dbt_tmp` to `intermediate`.`stg_product_category_name_translation` 
  
  ...
[0m22:04:39.725881 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    rename table `intermediate`.`stg_orders__dbt_tmp` to `intermediate`.`stg_orders` 
  
  ...
[0m22:04:39.727285 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.731118 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:39.736700 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */

    drop table if exists `intermediate`.`stg_products__dbt_backup` 
  
  ...
[0m22:04:39.738154 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.746129 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_product_category_name_translation: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_product_category_name_translation"} */

    drop table if exists `intermediate`.`stg_product_category_name_translation__dbt_backup` 
  ...
[0m22:04:39.758278 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_orders"} */

    drop table if exists `intermediate`.`stg_orders__dbt_backup` 
  ...
[0m22:04:39.764982 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:04:39.767285 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.772138 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */

    rename table `intermediate`.`stg_products` to `intermediate`.`stg_products__dbt_backup` 
  
  ...
[0m22:04:39.773882 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.776977 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c0bce8a2-b083-4eab-b60e-ff33bb1eb04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff813b97860>]}
[0m22:04:39.783664 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c0bce8a2-b083-4eab-b60e-ff33bb1eb04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff8326e4d10>]}
[0m22:04:39.785593 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.787179 [info ] [Thread-2 (]: 6 of 11 OK created sql view model `intermediate`.`stg_product_category_name_translation`  [[32mOK[0m in 0.40s]
[0m22:04:39.789428 [info ] [Thread-1 (]: 5 of 11 OK created sql view model `intermediate`.`stg_orders` .................. [[32mOK[0m in 0.41s]
[0m22:04:39.800007 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */

    drop table if exists `intermediate`.`stg_products` 
  
  ...
[0m22:04:39.802383 [debug] [Thread-2 (]: Finished running node model.olist_dbt.stg_product_category_name_translation
[0m22:04:39.804255 [debug] [Thread-1 (]: Finished running node model.olist_dbt.stg_orders
[0m22:04:39.808956 [debug] [Thread-3 (]: Began running node model.olist_dbt.fct_orders
[0m22:04:39.810534 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:39.811912 [info ] [Thread-3 (]: 8 of 11 START sql incremental model `reporting`.`fct_orders` ................... [RUN]
[0m22:04:39.815522 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */

    rename table `intermediate`.`stg_products__dbt_tmp` to `intermediate`.`stg_products` 
  
  ...
[0m22:04:39.817043 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_order_payments, now model.olist_dbt.fct_orders)
[0m22:04:39.819784 [debug] [Thread-3 (]: Began compiling node model.olist_dbt.fct_orders
[0m22:04:39.826935 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:39.845682 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.stg_products"} */

    drop table if exists `intermediate`.`stg_products__dbt_backup` 
  ...
[0m22:04:39.849970 [debug] [Thread-3 (]: Writing injected SQL for node "model.olist_dbt.fct_orders"
[0m22:04:39.853866 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:39.858081 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c0bce8a2-b083-4eab-b60e-ff33bb1eb04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff813b16c30>]}
[0m22:04:39.860602 [info ] [Thread-4 (]: 7 of 11 OK created sql view model `intermediate`.`stg_products` ................ [[32mOK[0m in 0.35s]
[0m22:04:39.863366 [debug] [Thread-4 (]: Finished running node model.olist_dbt.stg_products
[0m22:04:39.868525 [debug] [Thread-1 (]: Began running node model.olist_dbt.mart_product_performance
[0m22:04:39.870911 [info ] [Thread-1 (]: 9 of 11 START sql table model `reporting`.`mart_product_performance` ........... [RUN]
[0m22:04:39.872826 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_orders, now model.olist_dbt.mart_product_performance)
[0m22:04:39.874736 [debug] [Thread-1 (]: Began compiling node model.olist_dbt.mart_product_performance
[0m22:04:39.876277 [debug] [Thread-3 (]: Began executing node model.olist_dbt.fct_orders
[0m22:04:39.894797 [debug] [Thread-1 (]: Writing injected SQL for node "model.olist_dbt.mart_product_performance"
[0m22:04:39.944415 [debug] [Thread-1 (]: Began executing node model.olist_dbt.mart_product_performance
[0m22:04:40.037564 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.fct_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.fct_orders"} */

    select name, type from system.columns where table = 'fct_orders'
    
      and database = 'reporting'
    
    order by position
  ...
[0m22:04:40.072069 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m22:04:40.110020 [debug] [Thread-3 (]: Writing runtime sql for node "model.olist_dbt.fct_orders"
[0m22:04:40.152277 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_product_performance: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_product_performance"} */

            

    
        create table `reporting`.`mart_product_performance__dbt_backup`
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            with order_items as (
    select
        order_id,
        product_id,
        price,
        freight_value
    from `intermediate`.`stg_order_items`
),

order_reviews as (
    select
        order_id,
        avg(review_score) as avg_review_score
    from `intermediate`.`stg_order_reviews`
    group by 1
),

translations as (
    select * from `intermediate`.`stg_product_category_name_translation`
),


product_metrics as (
    select
        product_id,
        count(distinct order_id) as total_orders,
        sum(price) as total_revenue,
        sum(freight_value) as total_freight_cost,
        count(order_id) as total_units_sold
    from order_items
    group by 1
),

-- Aggregate review scores, joining through order_items to link reviews to products
product_reviews as (
    select
        product_id,
        avg(avg_review_score) as average_review_score
    from order_items
    left join order_reviews using(order_id)
    group by product_id
)

select
    p.product_id as product_id,
    t.product_category_name_english as product_category,
    coalesce(pm.total_units_sold, 0) as total_units_sold,
    coalesce(pm.total_revenue, 0) as total_revenue,
    coalesce(pr.average_review_score, 0) as average_review_score
from `intermediate`.`stg_products` p
left join product_metrics pm on p.product_id = pm.product_id
left join product_reviews pr on p.product_id = pr.product_id
left join translations t on p.product_category_name = t.product_category_name
where pm.total_orders is not null -- Only include products that have been sold
order by total_revenue desc
          )
        ...
[0m22:04:40.154008 [debug] [Thread-3 (]: dbt_clickhouse adapter: On model.olist_dbt.fct_orders: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.fct_orders"} */

        insert into `reporting`.`fct_orders`
        ("order_id", "customer_id", "order_status", "order_purchase_timestamp", "order_approved_at", "order_delivered_customer_date", "total_amount")-- sql


with order_payments as (
    select
        order_id,
        sum(toFloat64(payment_value_dollars)) as total_amount
    from `intermediate`.`stg_order_payments`
    group by 1
)

select
    o.order_id,
    o.customer_id,
    o.order_status,

    -- Always non-NULL DateTime for adapter's CAST('timestamp')
    ifNull(
      parseDateTimeBestEffortOrNull(nullIf(toString(o.order_purchase_timestamp), '')),
      toDateTime('1970-01-01 00:00:00')
    ) as order_purchase_timestamp,

    ifNull(
      parseDateTimeBestEffortOrNull(nullIf(toString(o.order_approved_at), '')),
      toDateTime('1970-01-01 00:00:00')
    ) as order_approved_at,

    ifNull(
      parseDateTimeBestEffortOrNull(nullIf(toString(o.order_delivered_customer_date), '')),
      toDateTime('1970-01-01 00:00:00')
    ) as order_delivered_customer_date,

    ifNull(op.total_amount, 0.0) as total_amount
from `intermediate`.`stg_orders` o
left join order_payments op on o.order_id = op.order_id


  where order_purchase_timestamp > (select max(order_purchase_timestamp) from `reporting`.`fct_orders`)

    ...
[0m22:04:40.186865 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m22:04:40.193568 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_product_performance: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_product_performance"} */

    select name, type from system.columns where table = 'mart_product_performance__dbt_backup'
    
      and database = 'reporting'
    
    order by position
  ...
[0m22:04:40.201989 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:40.207298 [debug] [Thread-1 (]: Writing runtime sql for node "model.olist_dbt.mart_product_performance"
[0m22:04:40.221378 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_product_performance: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_product_performance"} */

  
    
    
    
        
        insert into `reporting`.`mart_product_performance__dbt_backup`
        ("product_id", "product_category", "total_units_sold", "total_revenue", "average_review_score")with order_items as (
    select
        order_id,
        product_id,
        price,
        freight_value
    from `intermediate`.`stg_order_items`
),

order_reviews as (
    select
        order_id,
        avg(review_score) as avg_review_score
    from `intermediate`.`stg_order_reviews`
    group by 1
),

translations as (
    select * from `intermediate`.`stg_product_category_name_translation`
),


product_metrics as (
    select
        product_id,
        count(distinct order_id) as total_orders,
        sum(price) as total_revenue,
        sum(freight_value) as total_freight_cost,
        count(order_id) as total_units_sold
    from order_items
    group by 1
),

-- Aggregate review scores, joining through order_items to link reviews to products
product_reviews as (
    select
        product_id,
        avg(avg_review_score) as average_review_score
    from order_items
    left join order_reviews using(order_id)
    group by product_id
)

select
    p.product_id as product_id,
    t.product_category_name_english as product_category,
    coalesce(pm.total_units_sold, 0) as total_units_sold,
    coalesce(pm.total_revenue, 0) as total_revenue,
    coalesce(pr.average_review_score, 0) as average_review_score
from `intermediate`.`stg_products` p
left join product_metrics pm on p.product_id = pm.product_id
left join product_reviews pr on p.product_id = pr.product_id
left join translations t on p.product_category_name = t.product_category_name
where pm.total_orders is not null -- Only include products that have been sold
order by total_revenue desc
  ...
[0m22:04:40.303324 [debug] [Thread-3 (]: dbt_clickhouse adapter: SQL status: OK in 0.15 seconds
[0m22:04:40.306979 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c0bce8a2-b083-4eab-b60e-ff33bb1eb04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff831faf590>]}
[0m22:04:40.308412 [info ] [Thread-3 (]: 8 of 11 OK created sql incremental model `reporting`.`fct_orders` .............. [[32mOK[0m in 0.49s]
[0m22:04:40.310580 [debug] [Thread-3 (]: Finished running node model.olist_dbt.fct_orders
[0m22:04:40.312689 [debug] [Thread-4 (]: Began running node model.olist_dbt.mart_customer_revenue
[0m22:04:40.314092 [debug] [Thread-2 (]: Began running node model.olist_dbt.mart_monthly_category_revenue
[0m22:04:40.315791 [info ] [Thread-4 (]: 10 of 11 START sql table model `reporting`.`mart_customer_revenue` ............. [RUN]
[0m22:04:40.317712 [info ] [Thread-2 (]: 11 of 11 START sql table model `reporting`.`mart_monthly_category_revenue` ..... [RUN]
[0m22:04:40.319322 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_products, now model.olist_dbt.mart_customer_revenue)
[0m22:04:40.321305 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.olist_dbt.stg_product_category_name_translation, now model.olist_dbt.mart_monthly_category_revenue)
[0m22:04:40.322549 [debug] [Thread-4 (]: Began compiling node model.olist_dbt.mart_customer_revenue
[0m22:04:40.324013 [debug] [Thread-2 (]: Began compiling node model.olist_dbt.mart_monthly_category_revenue
[0m22:04:40.333684 [debug] [Thread-4 (]: Writing injected SQL for node "model.olist_dbt.mart_customer_revenue"
[0m22:04:40.343154 [debug] [Thread-2 (]: Writing injected SQL for node "model.olist_dbt.mart_monthly_category_revenue"
[0m22:04:40.351264 [debug] [Thread-4 (]: Began executing node model.olist_dbt.mart_customer_revenue
[0m22:04:40.352410 [debug] [Thread-2 (]: Began executing node model.olist_dbt.mart_monthly_category_revenue
[0m22:04:40.362106 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

            

    
        create table `reporting`.`mart_customer_revenue__dbt_backup`
        
  
        
  engine = MergeTree()
        order by (customer_unique_id)
        
        
        
        
                    -- end_of_sql
                    SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

                    
            empty
          as (
            

select
    assumeNotNull(c.customer_unique_id) as customer_unique_id ,
    c.customer_state,
    min(o.order_purchase_timestamp) as first_order_date,
    max(o.order_purchase_timestamp) as last_order_date,
    count(o.order_id) as number_of_orders,
    sum(o.total_amount) as total_revenue
from `reporting`.`fct_orders` o
join `intermediate`.`stg_customers` c on o.customer_id = c.customer_id
group by 1, 2
order by total_revenue desc
          )
        ...
[0m22:04:40.373594 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_monthly_category_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_monthly_category_revenue"} */

            

    
        create table `reporting`.`mart_monthly_category_revenue__dbt_backup`
        
  
        
  engine = MergeTree()
        
      order by (tuple())
        
        
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            with orders as (
    select order_id, order_purchase_timestamp from `reporting`.`fct_orders`
),

order_items as (
    select order_id, product_id, price from `intermediate`.`stg_order_items`
),

products as (
    select product_id, product_category_name from `intermediate`.`stg_products`
),

translations as (
    select * from `intermediate`.`stg_product_category_name_translation`
)

select
    toStartOfMonth(o.order_purchase_timestamp) as order_month,
    t.product_category_name_english as product_category,
    sum(oi.price) as total_revenue
from orders o
join order_items oi on o.order_id = oi.order_id
join products p on oi.product_id = p.product_id
left join translations t on p.product_category_name = t.product_category_name
where o.order_purchase_timestamp is not null and t.product_category_name_english is not null
group by 1, 2
order by 1, 3 desc
          )
        ...
[0m22:04:40.395208 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m22:04:40.406089 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

    select name, type from system.columns where table = 'mart_customer_revenue__dbt_backup'
    
      and database = 'reporting'
    
    order by position
  ...
[0m22:04:40.415440 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:40.421114 [debug] [Thread-4 (]: Writing runtime sql for node "model.olist_dbt.mart_customer_revenue"
[0m22:04:40.423352 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m22:04:40.432129 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_monthly_category_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_monthly_category_revenue"} */

    select name, type from system.columns where table = 'mart_monthly_category_revenue__dbt_backup'
    
      and database = 'reporting'
    
    order by position
  ...
[0m22:04:40.441816 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

  
    
    
    
        
        insert into `reporting`.`mart_customer_revenue__dbt_backup`
        ("customer_unique_id", "customer_state", "first_order_date", "last_order_date", "number_of_orders", "total_revenue")

select
    assumeNotNull(c.customer_unique_id) as customer_unique_id ,
    c.customer_state,
    min(o.order_purchase_timestamp) as first_order_date,
    max(o.order_purchase_timestamp) as last_order_date,
    count(o.order_id) as number_of_orders,
    sum(o.total_amount) as total_revenue
from `reporting`.`fct_orders` o
join `intermediate`.`stg_customers` c on o.customer_id = c.customer_id
group by 1, 2
order by total_revenue desc
  ...
[0m22:04:40.444149 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m22:04:40.449949 [debug] [Thread-2 (]: Writing runtime sql for node "model.olist_dbt.mart_monthly_category_revenue"
[0m22:04:40.463468 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_monthly_category_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_monthly_category_revenue"} */

  
    
    
    
        
        insert into `reporting`.`mart_monthly_category_revenue__dbt_backup`
        ("order_month", "product_category", "total_revenue")with orders as (
    select order_id, order_purchase_timestamp from `reporting`.`fct_orders`
),

order_items as (
    select order_id, product_id, price from `intermediate`.`stg_order_items`
),

products as (
    select product_id, product_category_name from `intermediate`.`stg_products`
),

translations as (
    select * from `intermediate`.`stg_product_category_name_translation`
)

select
    toStartOfMonth(o.order_purchase_timestamp) as order_month,
    t.product_category_name_english as product_category,
    sum(oi.price) as total_revenue
from orders o
join order_items oi on o.order_id = oi.order_id
join products p on oi.product_id = p.product_id
left join translations t on p.product_category_name = t.product_category_name
where o.order_purchase_timestamp is not null and t.product_category_name_english is not null
group by 1, 2
order by 1, 3 desc
  ...
[0m22:04:40.730089 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.51 seconds
[0m22:04:40.739934 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_product_performance: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_product_performance"} */
EXCHANGE TABLES `reporting`.`mart_product_performance__dbt_backup` AND `reporting`.`mart_product_performance` 
  
  ...
[0m22:04:40.745491 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:40.754806 [debug] [Thread-1 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_product_performance: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_product_performance"} */

    drop table if exists `reporting`.`mart_product_performance__dbt_backup` 
  ...
[0m22:04:40.759415 [debug] [Thread-1 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:40.763821 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c0bce8a2-b083-4eab-b60e-ff33bb1eb04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff813a72090>]}
[0m22:04:40.765521 [info ] [Thread-1 (]: 9 of 11 OK created sql table model `reporting`.`mart_product_performance` ...... [[32mOK[0m in 0.89s]
[0m22:04:40.767606 [debug] [Thread-1 (]: Finished running node model.olist_dbt.mart_product_performance
[0m22:04:40.778358 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.31 seconds
[0m22:04:40.780911 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_monthly_category_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_monthly_category_revenue"} */
EXCHANGE TABLES `reporting`.`mart_monthly_category_revenue__dbt_backup` AND `reporting`.`mart_monthly_category_revenue` 
  
  ...
[0m22:04:40.785584 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:40.795223 [debug] [Thread-2 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_monthly_category_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_monthly_category_revenue"} */

    drop table if exists `reporting`.`mart_monthly_category_revenue__dbt_backup` 
  ...
[0m22:04:40.814208 [debug] [Thread-2 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:40.818328 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c0bce8a2-b083-4eab-b60e-ff33bb1eb04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff813cfacc0>]}
[0m22:04:40.820146 [info ] [Thread-2 (]: 11 of 11 OK created sql table model `reporting`.`mart_monthly_category_revenue`  [[32mOK[0m in 0.50s]
[0m22:04:40.825070 [debug] [Thread-2 (]: Finished running node model.olist_dbt.mart_monthly_category_revenue
[0m22:04:40.914682 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.47 seconds
[0m22:04:40.917264 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */
EXCHANGE TABLES `reporting`.`mart_customer_revenue__dbt_backup` AND `reporting`.`mart_customer_revenue` 
  
  ...
[0m22:04:40.921390 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:40.929116 [debug] [Thread-4 (]: dbt_clickhouse adapter: On model.olist_dbt.mart_customer_revenue: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "olist_dbt", "target_name": "dev", "node_id": "model.olist_dbt.mart_customer_revenue"} */

    drop table if exists `reporting`.`mart_customer_revenue__dbt_backup` 
  ...
[0m22:04:40.933026 [debug] [Thread-4 (]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m22:04:40.935955 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c0bce8a2-b083-4eab-b60e-ff33bb1eb04e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff813be3ad0>]}
[0m22:04:40.937354 [info ] [Thread-4 (]: 10 of 11 OK created sql table model `reporting`.`mart_customer_revenue` ........ [[32mOK[0m in 0.62s]
[0m22:04:40.939524 [debug] [Thread-4 (]: Finished running node model.olist_dbt.mart_customer_revenue
[0m22:04:40.944177 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:04:40.945293 [debug] [MainThread]: Connection 'model.olist_dbt.mart_monthly_category_revenue' was left open.
[0m22:04:40.946115 [debug] [MainThread]: On model.olist_dbt.mart_monthly_category_revenue: Close
[0m22:04:40.946762 [debug] [MainThread]: Connection 'model.olist_dbt.mart_product_performance' was left open.
[0m22:04:40.947480 [debug] [MainThread]: On model.olist_dbt.mart_product_performance: Close
[0m22:04:40.948142 [debug] [MainThread]: Connection 'model.olist_dbt.fct_orders' was left open.
[0m22:04:40.948876 [debug] [MainThread]: On model.olist_dbt.fct_orders: Close
[0m22:04:40.949597 [debug] [MainThread]: Connection 'model.olist_dbt.mart_customer_revenue' was left open.
[0m22:04:40.950293 [debug] [MainThread]: On model.olist_dbt.mart_customer_revenue: Close
[0m22:04:40.951711 [info ] [MainThread]: 
[0m22:04:40.952877 [info ] [MainThread]: Finished running 7 view models, 1 incremental model, 3 table models in 0 hours 0 minutes and 2.48 seconds (2.48s).
[0m22:04:40.958219 [debug] [MainThread]: Command end result
[0m22:04:41.049813 [info ] [MainThread]: 
[0m22:04:41.050747 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:04:41.052314 [info ] [MainThread]: 
[0m22:04:41.053812 [info ] [MainThread]: Done. PASS=11 WARN=0 ERROR=0 SKIP=0 TOTAL=11
[0m22:04:41.056915 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.8943934, "process_in_blocks": "0", "process_kernel_time": 0.509286, "process_mem_max_rss": "123480", "process_out_blocks": "2976", "process_user_time": 6.730575}
[0m22:04:41.058721 [debug] [MainThread]: Command `dbt run` succeeded at 22:04:41.058339 after 4.90 seconds
[0m22:04:41.060255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff831ee7230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff813be9700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff813beb1a0>]}
[0m22:04:41.061732 [debug] [MainThread]: Flushing usage events
